//     Underscore.js 1.4.2
//     http://underscorejs.org
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.
function EventedArray(e){this.stack=[];this.mutationHandler=e||function(){};this.setHandler=function(e){this.mutationHandler=e};this.callHandler=function(){typeof this.mutationHandler=="function"&&this.mutationHandler()};this.push=function(e){this.stack.push(e);this.callHandler()};this.shift=function(){this.stack.shift()};this.pop=function(){return this.stack.pop()};this.getArray=function(){return this.stack};this.unshift=function(e){this.stack.unshift(e);this.callHandler()};this.clear=function(){this.stack=[];recognition.stop()}}(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=r.unshift,l=i.toString,c=i.hasOwnProperty,h=r.forEach,p=r.map,d=r.reduce,v=r.reduceRight,m=r.filter,g=r.every,y=r.some,b=r.indexOf,w=r.lastIndexOf,E=Array.isArray,S=Object.keys,x=s.bind,T=function(e){if(e instanceof T)return e;if(!(this instanceof T))return new T(e);this._wrapped=e};if(typeof exports!="undefined"){typeof module!="undefined"&&module.exports&&(exports=module.exports=T);exports._=T}else e._=T;T.VERSION="1.4.2";var N=T.each=T.forEach=function(e,t,r){if(e==null)return;if(h&&e.forEach===h)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(T.has(e,o)&&t.call(r,e[o],o,e)===n)return};T.map=T.collect=function(e,t,n){var r=[];if(e==null)return r;if(p&&e.map===p)return e.map(t,n);N(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)});return r};T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduce===d){r&&(t=T.bind(t,r));return i?e.reduce(t,n):e.reduce(t)}N(e,function(e,s,o){if(!i){n=e;i=!0}else n=t.call(r,n,e,s,o)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n};T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(v&&e.reduceRight===v){r&&(t=T.bind(t,r));return arguments.length>2?e.reduceRight(t,n):e.reduceRight(t)}var s=e.length;if(s!==+s){var o=T.keys(e);s=o.length}N(e,function(u,a,f){a=o?o[--s]:--s;if(!i){n=e[a];i=!0}else n=t.call(r,n,e[a],a,f)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n};T.find=T.detect=function(e,t,n){var r;C(e,function(e,i,s){if(t.call(n,e,i,s)){r=e;return!0}});return r};T.filter=T.select=function(e,t,n){var r=[];if(e==null)return r;if(m&&e.filter===m)return e.filter(t,n);N(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)});return r};T.reject=function(e,t,n){var r=[];if(e==null)return r;N(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)});return r};T.every=T.all=function(e,t,r){t||(t=T.identity);var i=!0;if(e==null)return i;if(g&&e.every===g)return e.every(t,r);N(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n});return!!i};var C=T.some=T.any=function(e,t,r){t||(t=T.identity);var i=!1;if(e==null)return i;if(y&&e.some===y)return e.some(t,r);N(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n});return!!i};T.contains=T.include=function(e,t){var n=!1;if(e==null)return n;if(b&&e.indexOf===b)return e.indexOf(t)!=-1;n=C(e,function(e){return e===t});return n};T.invoke=function(e,t){var n=u.call(arguments,2);return T.map(e,function(e){return(T.isFunction(t)?t:e[t]).apply(e,n)})};T.pluck=function(e,t){return T.map(e,function(e){return e[t]})};T.where=function(e,t){return T.isEmpty(t)?[]:T.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})};T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-Infinity;var r={computed:-Infinity};N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})});return r.value};T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return Infinity;var r={computed:Infinity};N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})});return r.value};T.shuffle=function(e){var t,n=0,r=[];N(e,function(e){t=T.random(n++);r[n-1]=r[t];r[t]=e});return r};var k=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,n){var r=k(t);return T.pluck(T.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t);N(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)});return i};T.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(T.has(e,t)?e[t]:e[t]=[]).push(n)})};T.countBy=function(e,t,n){return L(e,t,n,function(e,t,n){T.has(e,t)||(e[t]=0);e[t]++})};T.sortedIndex=function(e,t,n,r){n=n==null?T.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s};T.toArray=function(e){return e?e.length===+e.length?u.call(e):T.values(e):[]};T.size=function(e){return e.length===+e.length?e.length:T.keys(e).length};T.first=T.head=T.take=function(e,t,n){return t!=null&&!n?u.call(e,0,t):e[0]};T.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))};T.last=function(e,t,n){return t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]};T.rest=T.tail=T.drop=function(e,t,n){return u.call(e,t==null||n?1:t)};T.compact=function(e){return T.filter(e,function(e){return!!e})};var A=function(e,t,n){N(e,function(e){T.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)});return n};T.flatten=function(e,t){return A(e,t,[])};T.without=function(e){return T.difference(e,u.call(arguments,1))};T.uniq=T.unique=function(e,t,n,r){var i=n?T.map(e,n,r):e,s=[],o=[];N(i,function(n,r){if(t?!r||o[o.length-1]!==n:!T.contains(o,n)){o.push(n);s.push(e[r])}});return s};T.union=function(){return T.uniq(a.apply(r,arguments))};T.intersection=function(e){var t=u.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})};T.difference=function(e){var t=a.apply(r,u.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})};T.zip=function(){var e=u.call(arguments),t=T.max(T.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=T.pluck(e,""+r);return n};T.object=function(e,t){var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n};T.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number"){r=T.sortedIndex(e,t);return e[r]===t?r:-1}r=n<0?Math.max(0,i+n):n}if(b&&e.indexOf===b)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1};T.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(w&&e.lastIndexOf===w)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1};T.range=function(e,t,n){if(arguments.length<=1){t=e||0;e=0}n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r){s[i++]=e;e+=n}return s};var O=function(){};T.bind=function(t,n){var r,i;if(t.bind===x&&x)return x.apply(t,u.call(arguments,1));if(!T.isFunction(t))throw new TypeError;i=u.call(arguments,2);return r=function(){if(this instanceof r){O.prototype=t.prototype;var e=new O,s=t.apply(e,i.concat(u.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(u.call(arguments)))}};T.bindAll=function(e){var t=u.call(arguments,1);t.length==0&&(t=T.functions(e));N(t,function(t){e[t]=T.bind(e[t],e)});return e};T.memoize=function(e,t){var n={};t||(t=T.identity);return function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}};T.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)};T.defer=function(e){return T.delay.apply(T,[e,1].concat(u.call(arguments,1)))};T.throttle=function(e,t){var n,r,i,s,o,u,a=T.debounce(function(){o=s=!1},t);return function(){n=this;r=arguments;var f=function(){i=null;o&&(u=e.apply(n,r));a()};i||(i=setTimeout(f,t));if(s)o=!0;else{s=!0;u=e.apply(n,r)}a();return u}};T.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null;n||(i=e.apply(s,o))},a=n&&!r;clearTimeout(r);r=setTimeout(u,t);a&&(i=e.apply(s,o));return i}};T.once=function(e){var t=!1,n;return function(){if(t)return n;t=!0;n=e.apply(this,arguments);e=null;return n}};T.wrap=function(e,t){return function(){var n=[e];o.apply(n,arguments);return t.apply(this,n)}};T.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}};T.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}};T.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)T.has(e,n)&&(t[t.length]=n);return t};T.values=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push(e[n]);return t};T.pairs=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push([n,e[n]]);return t};T.invert=function(e){var t={};for(var n in e)T.has(e,n)&&(t[e[n]]=n);return t};T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()};T.extend=function(e){N(u.call(arguments,1),function(t){for(var n in t)e[n]=t[n]});return e};T.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));N(n,function(n){n in e&&(t[n]=e[n])});return t};T.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)T.contains(n,i)||(t[i]=e[i]);return t};T.defaults=function(e){N(u.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])});return e};T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e};T.tap=function(e,t){t(e);return e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof T&&(e=e._wrapped);t instanceof T&&(t=t._wrapped);var i=l.call(e);if(i!=l.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e);r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length;u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,f=t.constructor;if(a!==f&&!(T.isFunction(a)&&a instanceof a&&T.isFunction(f)&&f instanceof f))return!1;for(var c in e)if(T.has(e,c)){o++;if(!(u=T.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(T.has(t,c)&&!(o--))break;u=!o}}n.pop();r.pop();return u};T.isEqual=function(e,t){return M(e,t,[],[])};T.isEmpty=function(e){if(e==null)return!0;if(T.isArray(e)||T.isString(e))return e.length===0;for(var t in e)if(T.has(e,t))return!1;return!0};T.isElement=function(e){return!!e&&e.nodeType===1};T.isArray=E||function(e){return l.call(e)=="[object Array]"};T.isObject=function(e){return e===Object(e)};N(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}});T.isArguments(arguments)||(T.isArguments=function(e){return!!e&&!!T.has(e,"callee")});typeof /./!="function"&&(T.isFunction=function(e){return typeof e=="function"});T.isFinite=function(e){return T.isNumber(e)&&isFinite(e)};T.isNaN=function(e){return T.isNumber(e)&&e!=+e};T.isBoolean=function(e){return e===!0||e===!1||l.call(e)=="[object Boolean]"};T.isNull=function(e){return e===null};T.isUndefined=function(e){return e===void 0};T.has=function(e,t){return c.call(e,t)};T.noConflict=function(){e._=t;return this};T.identity=function(e){return e};T.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)};T.random=function(e,t){if(t==null){t=e;e=0}return e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=T.invert(_.escape);var D={escape:new RegExp("["+T.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(_.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}});T.result=function(e,t){if(e==null)return null;var n=e[t];return T.isFunction(n)?n.call(e):n};T.mixin=function(e){N(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];o.apply(e,arguments);return F.call(this,n.apply(T,e))}})};var P=0;T.uniqueId=function(e){var t=P++;return e?e+t:t};T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){n=T.defaults({},n,T.templateSettings);var r=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]});s+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":o?"';\n"+o+"\n__p+='":"";i=u+t.length});s+="';\n";n.variable||(s="with(obj||{}){\n"+s+"}\n");s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(n.variable||"obj","_",s)}catch(u){u.source=s;throw u}if(t)return o(t,T);var a=function(e){return o.call(this,e,T)};a.source="function("+(n.variable||"obj")+"){\n"+s+"}";return a};T.chain=function(e){return T(e).chain()};var F=function(e){return this._chain?T(e).chain():e};T.mixin(T);N(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];T.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);(e=="shift"||e=="splice")&&n.length===0&&delete n[0];return F.call(this,n)}});N(["concat","join","slice"],function(e){var t=r[e];T.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}});T.extend(T.prototype,{chain:function(){this._chain=!0;return this},value:function(){return this._wrapped}})}).call(this);!function(e,t){"use strict";var n=t.prototype.trim,r=t.prototype.trimRight,i=t.prototype.trimLeft,s=function(e){return e*1||0},o=function(e,t){if(t<1)return"";var n="";while(t>0){t&1&&(n+=e);t>>=1,e+=e}return n},u=[].slice,a=function(e){return e==null?"\\s":e.source?e.source:"["+_s.escapeRegExp(e)+"]"},f={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"},l={};for(var c in f)l[f[c]]=c;l["'"]="#39";var h=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var n=o,r=function(){r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0]));return r.format.call(null,r.cache[arguments[0]],arguments)};r.format=function(r,i){var s=1,o=r.length,u="",a,f=[],l,c,p,d,v,m;for(l=0;l<o;l++){u=e(r[l]);if(u==="string")f.push(r[l]);else if(u==="array"){p=r[l];if(p[2]){a=i[s];for(c=0;c<p[2].length;c++){if(!a.hasOwnProperty(p[2][c]))throw new Error(h('[_.sprintf] property "%s" does not exist',p[2][c]));a=a[p[2][c]]}}else p[1]?a=i[p[1]]:a=i[s++];if(/[^s]/.test(p[8])&&e(a)!="number")throw new Error(h("[_.sprintf] expecting number but found %s",e(a)));switch(p[8]){case"b":a=a.toString(2);break;case"c":a=t.fromCharCode(a);break;case"d":a=parseInt(a,10);break;case"e":a=p[7]?a.toExponential(p[7]):a.toExponential();break;case"f":a=p[7]?parseFloat(a).toFixed(p[7]):parseFloat(a);break;case"o":a=a.toString(8);break;case"s":a=(a=t(a))&&p[7]?a.substring(0,p[7]):a;break;case"u":a=Math.abs(a);break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase()}a=/[def]/.test(p[8])&&p[3]&&a>=0?"+"+a:a;v=p[4]?p[4]=="0"?"0":p[4].charAt(1):" ";m=p[6]-t(a).length;d=p[6]?n(v,m):"";f.push(p[5]?a+d:d+a)}}return f.join("")};r.cache={};r.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw new Error("[_.sprintf] huh?");if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");r.push(n)}t=t.substring(n[0].length)}return r};return r}();window._s={VERSION:"2.3.0",isBlank:function(e){e==null&&(e="");return/^\s*$/.test(e)},stripTags:function(e){return e==null?"":t(e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){e=e==null?"":t(e);return e.charAt(0).toUpperCase()+e.slice(1)},chop:function(e,n){if(e==null)return[];e=t(e);n=~~n;return n>0?e.match(new RegExp(".{1,"+n+"}","g")):[e]},clean:function(e){return _s.strip(e).replace(/\s+/g," ")},count:function(e,n){if(e==null||n==null)return 0;e=t(e);n=t(n);var r=0,i=0,s=n.length;for(;;){i=e.indexOf(n,i);if(i===-1)break;r++;i+=s}return r},chars:function(e){return e==null?[]:t(e).split("")},swapCase:function(e){return e==null?"":t(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},escapeHTML:function(e){return e==null?"":t(e).replace(/[&<>"']/g,function(e){return"&"+l[e]+";"})},unescapeHTML:function(e){return e==null?"":t(e).replace(/\&([^;]+);/g,function(e,n){var r;return n in f?f[n]:(r=n.match(/^#x([\da-fA-F]+)$/))?t.fromCharCode(parseInt(r[1],16)):(r=n.match(/^#(\d+)$/))?t.fromCharCode(~~r[1]):e})},escapeRegExp:function(e){return e==null?"":t(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(e,t,n,r){var i=_s.chars(e);i.splice(~~t,~~n,r);return i.join("")},insert:function(e,t,n){return _s.splice(e,t,0,n)},include:function(e,n){return n===""?!0:e==null?!1:t(e).indexOf(n)!==-1},join:function(){var e=u.call(arguments),t=e.shift();t==null&&(t="");return e.join(t)},lines:function(e){return e==null?[]:t(e).split("\n")},reverse:function(e){return _s.chars(e).reverse().join("")},startsWith:function(e,n){if(n==="")return!0;if(e==null||n==null)return!1;e=t(e);n=t(n);return e.length>=n.length&&e.slice(0,n.length)===n},endsWith:function(e,n){if(n==="")return!0;if(e==null||n==null)return!1;e=t(e);n=t(n);return e.length>=n.length&&e.slice(e.length-n.length)===n},succ:function(e){if(e==null)return"";e=t(e);return e.slice(0,-1)+t.fromCharCode(e.charCodeAt(e.length-1)+1)},titleize:function(e){return e==null?"":t(e).replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},camelize:function(e){return _s.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t.toUpperCase()})},underscored:function(e){return _s.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return _s.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(e){return _s.titleize(t(e).replace(/_/g," ")).replace(/\s/g,"")},humanize:function(e){return _s.capitalize(_s.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,r){if(e==null)return"";if(!r&&n)return n.call(e);r=a(r);return t(e).replace(new RegExp("^"+r+"+|"+r+"+$","g"),"")},ltrim:function(e,n){if(e==null)return"";if(!n&&i)return i.call(e);n=a(n);return t(e).replace(new RegExp("^"+n+"+"),"")},rtrim:function(e,n){if(e==null)return"";if(!n&&r)return r.call(e);n=a(n);return t(e).replace(new RegExp(n+"+$"),"")},truncate:function(e,n,r){if(e==null)return"";e=t(e);r=r||"...";n=~~n;return e.length>n?e.slice(0,n)+r:e},prune:function(e,n,r){if(e==null)return"";e=t(e);n=~~n;r=r!=null?t(r):"...";if(e.length<=n)return e;var i=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},s=e.slice(0,n+1).replace(/.(?=\W*\w*$)/g,i);s.slice(s.length-2).match(/\w\w/)?s=s.replace(/\s*\S+$/,""):s=_s.rtrim(s.slice(0,s.length-1));return(s+r).length>e.length?e:e.slice(0,s.length)+r},words:function(e,t){return _s.isBlank(e)?[]:_s.trim(e,t).split(t||/\s+/)},pad:function(e,n,r,i){e=e==null?"":t(e);n=~~n;var s=0;r?r.length>1&&(r=r.charAt(0)):r=" ";switch(i){case"right":s=n-e.length;return e+o(r,s);case"both":s=n-e.length;return o(r,Math.ceil(s/2))+e+o(r,Math.floor(s/2));default:s=n-e.length;return o(r,s)+e}},lpad:function(e,t,n){return _s.pad(e,t,n)},rpad:function(e,t,n){return _s.pad(e,t,n,"right")},lrpad:function(e,t,n){return _s.pad(e,t,n,"both")},sprintf:h,vsprintf:function(e,t){t.unshift(e);return h.apply(null,t)},toNumber:function(e,t){if(!e)return 0;e=_s.trim(e);return e.match(/^-?\d+(?:\.\d+)?$/)?s(s(e).toFixed(~~t)):NaN},numberFormat:function(e,t,n,r){if(isNaN(e)||e==null)return"";e=e.toFixed(~~t);r=typeof r=="string"?r:",";var i=e.split("."),s=i[0],o=i[1]?(n||".")+i[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+o},strRight:function(e,n){if(e==null)return"";e=t(e);n=n!=null?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},strRightBack:function(e,n){if(e==null)return"";e=t(e);n=n!=null?t(n):n;var r=n?e.lastIndexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},strLeft:function(e,n){if(e==null)return"";e=t(e);n=n!=null?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(0,r):e},strLeftBack:function(e,t){if(e==null)return"";e+="";t=t!=null?""+t:t;var n=e.lastIndexOf(t);return~n?e.slice(0,n):e},toSentence:function(e,t,n,r){t=t||", ";n=n||" and ";var i=e.slice(),s=i.pop();e.length>2&&r&&(n=_s.rtrim(t)+n);return i.length?i.join(t)+n+s:s},toSentenceSerial:function(){var e=u.call(arguments);e[3]=!0;return _s.toSentence.apply(_s,e)},slugify:function(e){if(e==null)return"";var n="ąàáäâãåæćęèéëêìíïîłńòóöôõøùúüûñçżź",r="aaaaaaaaceeeeeiiiilnoooooouuuunczz",i=new RegExp(a(n),"g");e=t(e).toLowerCase().replace(i,function(e){var t=n.indexOf(e);return r.charAt(t)||"-"});return _s.dasherize(e.replace(/[^\w\s-]/g,""))},surround:function(e,t){return[t,e,t].join("")},quote:function(e){return _s.surround(e,'"')},exports:function(){var e={};for(var t in this){if(!this.hasOwnProperty(t)||t.match(/^(?:include|contains|reverse)$/))continue;e[t]=this[t]}return e},repeat:function(e,n,r){if(e==null)return"";n=~~n;if(r==null)return o(t(e),n);for(var i=[];n>0;i[--n]=e);return i.join(r)},levenshtein:function(e,n){if(e==null&&n==null)return 0;if(e==null)return t(n).length;if(n==null)return t(e).length;e=t(e);n=t(n);var r=[],i,s;for(var o=0;o<=n.length;o++)for(var u=0;u<=e.length;u++){o&&u?e.charAt(u-1)===n.charAt(o-1)?s=i:s=Math.min(r[u],r[u-1],i)+1:s=o+u;i=r[u];r[u]=s}return r.pop()}};_s.strip=_s.trim;_s.lstrip=_s.ltrim;_s.rstrip=_s.rtrim;_s.center=_s.lrpad;_s.rjust=_s.lpad;_s.ljust=_s.rpad;_s.contains=_s.include;_s.q=_s.quote;if(typeof exports!="undefined"){typeof module!="undefined"&&module.exports&&(module.exports=_s);exports._s=_s}typeof define=="function"&&define.amd&&define("underscore.string",[],function(){return _s});e._=e._||{};e._.string=e._.str=_s}(this,String);helpers={parseyear:function(e){return e.substr(0,4)},localStorageSafety:function(e){if(localStorage[e]==null||localStorage[e]==undefined||localStorage[e]=="undefined")localStorage[e]="[]"},getLocalStorage:function(e){this.localStorageSafety(e);return JSON.parse(localStorage[e])},addToLocalStorage:function(e,t,n){this.localStorageSafety(e);var r=this.getLocalStorage(e);n?r.unshift(t):r.push(t);e=="history"&&(r=_.last(r,50));localStorage[e]=JSON.stringify(r);return this.getLocalStorage(e)},clearLocalStorage:function(e){localStorage[e]="[]";return this.getLocalStorage(e)},parseDOM:function(e){return e instanceof HTMLElement?e.dataset:e},parsetime:function(e){var t=e>5e3?1e3:1,n=Math.round(e/t),r=Math.floor(n/60),i=n-r*60;i<10&&(i="0"+i);return r+":"+i},slugify:function(e){if(e==null)return"";var t="ąàáäâãåæćęèéëêìíïîłńòóöôõøśùúüûñçżź",n="aaaaaaaaceeeeeiiiilnoooooosuuuunczz",r=new RegExp(helpers.defaultToWhiteSpace(t),"g");e=String(e).toLowerCase().replace(r,function(e){var r=t.indexOf(e);return n.charAt(r)||"-"});return _s.dasherize(e.replace(/[^\w\s-]/g,""))},defaultToWhiteSpace:function(e){return e==null?"\\s":e.source?e.source:"["+helpers.escapeRegExp(e)+"]"},escapeRegExp:function(e){return e==null?"":String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},parseYTId:function(e){return e==undefined?null:e.id.$t.substr(-11)},createID:function(){var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var n=0;n<64;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},getHQAlbumImage:function(e,t){var n=e.image,r=t?t:"400",i=n.replace("100x100-75.jpg",r+"x"+r+"-75.jpg");return i},coverArrayToHQ:function(e,t){var n=[];for(i=0;i<e.length;i++)n.push(helpers.getHQAlbumImage({image:e[i]},t));return n},parsetext:function(e){var e=e+"",t=e.indexOf("(")!=-1?'<span class="lighttext">'+e.substr(e.indexOf("(")).substr(1).replace(")","")+"</span>":"",n=e.indexOf("(")!=-1?e.substr(0,e.indexOf("(")):e;return n+t},parsehours:function(e){var t=e/1e3,n;t<90?n="One minute":t<3600?n=Math.round(t/60)+" minutes":3600<=t?n=Math.round(t/360)/10+" hours":n="Unknown length";return n},albumRelevance:function(e,t){var n=t,r=[{word:"remix",reason:"This album only contains Remixes of one song:"},{word:"instrumental",reason:"This is is the Instrumental version of"},{word:"- ep",reason:"This album may contain duplicate tracks:"},{word:"acoustic",reason:"This album is an acoustic version:"},{word:"itunes",reason:"This album is an itunes version:"},{word:"live",reason:"This is a live album:"},{word:"karaoke",reason:"This is a karaoke/instrumental version: "}];n.each(r,function(t){(e.name+"").toLowerCase().indexOf(t.word)!=-1&&(e.hidden=t.reason)});e.tracks>30&&(e.hidden="This album is very long ("+e.tracks+" tracks):");return e},parseAlbumTitle:function(e){var t=e.name+"",n=t.substr(0,t.indexOf("(")==-1?t.length:t.indexOf("(")-1),r=/\(([^()]+)\)/g,i=t.match(r),s=i?i[0].substr(1,i[0].length-2):null;e.name=n;e.subtitle=s;return e}};this.helpers=helpers;views={artist:{load:function(e){$.ajax({url:"/api/artist/"+e,dataType:"html",success:function(e){var t=$("#view");t.html(e);views.loadingindicator.hide();$.publish("new-tracks-entered-dom")},error:function(){errors.draw(404)}})}},playlist:{load:function(e){$.ajax({url:"/api"+e,dataType:"html",success:function(e){$("#view").html(e);$.publish("new-tracks-entered-dom")}})}},song:{load:function(e){$.ajax({url:"/api/song/"+e,dataType:"html",success:function(e){$("#view").html(e);$.publish("new-tracks-entered-dom")}})}},album:{load:function(e){$.ajax({url:"/api/album/"+e,dataType:"html",success:function(e){var t=$("#view");t.html(e);views.loadingindicator.hide();$.publish("new-tracks-entered-dom")},error:function(){errors.draw(404)}})}},track:{load:function(e){$.ajax({url:"/api/track/"+e,dataType:"html",success:function(e){var t=$("#view");t.html(e);views.loadingindicator.hide()},error:function(){errors.draw(404)}})}},charts:{load:function(){$.ajax({url:"/api/charts",dataType:"html",success:function(e){var t=$("#view");t.html(e);views.loadingindicator.hide();$.publish("new-tracks-entered-dom")},error:function(){errors.draw(404)}})}},retrocharts:{load:function(e){$.ajax({url:"/api/charts/"+e,dataType:"html",success:function(e){var t=$("#view");t.html(e);$.publish("new-tracks-entered-dom")}})}},about:{load:function(){$.ajax({url:"/api/about",dataType:"html",success:function(e){var t=$("#view");t.html(e);views.loadingindicator.hide()},error:function(){errors.draw(404)}})}},loadingindicator:{hide:function(){var e=$(".loading-indicator").remove()}},library:{load:function(){$.ajax({url:"/api/library",dataType:"html",success:function(e){var t=$("#view");t.html(e);views.loadingindicator.hide();$.publish("new-tracks-entered-dom")},error:function(){errors.draw(404)}})}},lyrics:{load:function(e){$.ajax({url:"/api/lyrics/"+e,dataType:"html",success:function(e){var t=$("#view");t.html(e)}})}},reddit:{load:function(){$.ajax({url:"/api/reddit",dataType:"html",success:function(e){var t=$("#view");t.html(e);views.loadingindicator.hide();$.publish("new-tracks-entered-dom")},error:function(){errors.draw(404)}})}},settings:{get:function(){$.ajax({url:"/api/settings",dataType:"html",success:function(e){$("#view").html(e);views.loadingindicator.hide()},error:function(){errors.draw(4040)}})}},main:{get:function(){$.ajax({url:"/api/main",dataType:"html",success:function(e){$("#view").html(e);views.loadingindicator.hide();$.publish("new-tracks-entered-dom")},error:function(){errors.draw(404)}})}}};routes={"/charts":function(e){views.charts.load()},"/album/:id":function(e){views.album.load(e[1])},"/about":function(e){views.about.load()},"/track/:id":function(e){views.track.load(e[1])},"/register":function(e){registration.facebook.load()},"/library":function(e){views.library.load(e[1])},settings:function(e){views.settings.get()},"/home":function(e){views.main.get()},"/artist/:id":function(e){views.artist.load(e[1])},"/lyrics/:id":function(e){views.lyrics.load(e[1])},"/u/:name/p/:name":function(e){views.playlist.load(e[0]);$("#drop-target-label").text("this playlist")},"/reddit":function(e){views.reddit.load()},"/":function(e){views.main.get()},"/song/:id":function(e){views.song.load(e[1])},"/retro-charts/:id":function(e){views.retrocharts.load(e[1])},"/logout":function(e){window.location="/logout"},"/login":function(e){window.location="/auth/facebook"}};$(document).on("ready",function(){var e=window.location.pathname;navigation.to(e)}).on("mousedown","[data-navigate]",function(e){if(e.button==2)return;var t=$(this).attr("data-navigate");e.preventDefault();navigation.to(t)});var showSpinner=function(){var e=loader.spinner();$("#view").html(e)};loader={spinner:function(){return'<div class="loading-indicator"><div class="spinner"></div></div>'}};navigation={to:function(e,t){$.each(routes,function(n,r){var i=new RegExp(n.replace(/:[name]+/g,"([\\a-z0-9-]+)").replace(/:[id]+/g,"([\\d]+)")),s=e.match(i);if(s&&s!="/"||s=="/"&&e=="/"){$("#drop-target-label").text("your library");r(s);showSpinner();var o=t?"replaceState":"pushState";history[o](null,null,e);$("#view").attr("data-route",e)}});var n='[data-navigate="'+e+'"]';$(".menuselected").removeClass("menuselected");$(n).addClass("menuselected")}};window.onpopstate=function(){var e=window.location.pathname;navigation.to(e,!0)};var io="undefined"==typeof module?{}:module.exports;(function(){(function(e,t){var n=e;n.version="0.9.11";n.protocol=1;n.transports=[];n.j=[];n.sockets={};n.connect=function(e,r){var i=n.util.parseUri(e),s,o;if(t&&t.location){i.protocol=i.protocol||t.location.protocol.slice(0,-1);i.host=i.host||(t.document?t.document.domain:t.location.hostname);i.port=i.port||t.location.port}s=n.util.uniqueUri(i);var u={host:i.host,secure:"https"==i.protocol,port:i.port||("https"==i.protocol?443:80),query:i.query||""};n.util.merge(u,r);if(u["force new connection"]||!n.sockets[s])o=new n.Socket(u);!u["force new connection"]&&o&&(n.sockets[s]=o);o=o||n.sockets[s];return o.of(i.path.length>1?i.path:"")}})("object"==typeof module?module.exports:this.io={},this);(function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){var t=r.exec(e||""),n={},s=14;while(s--)n[i[s]]=t[s]||"";return n};n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;if("document"in t){r=r||document.domain;i=i||(n=="https"&&document.location.protocol!=="https:"?443:document.location.port)}else{r=r||"localhost";!i&&n=="https"&&(i=443)}return(n||"http")+"://"+r+":"+(i||80)};n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];n.merge(r,n.chunkQuery(t||""));for(var s in r)r.hasOwnProperty(s)&&i.push(s+"="+r[s]);return i.length?"?"+i.join("&"):""};n.chunkQuery=function(e){var t={},n=e.split("&"),r=0,i=n.length,s;for(;r<i;++r){s=n[r].split("=");s[0]&&(t[s[0]]=s[1])}return t};var s=!1;n.load=function(e){if("document"in t&&document.readyState==="complete"||s)return e();n.on(t,"load",e,!1)};n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)};n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null};"undefined"!=typeof window&&n.load(function(){s=!0});n.defer=function(e){if(!n.
ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})};n.merge=function(t,r,i,s){var o=s||[],u=typeof i=="undefined"?2:i,a;for(a in r)if(r.hasOwnProperty(a)&&n.indexOf(o,a)<0)if(typeof t[a]!="object"||!u){t[a]=r[a];o.push(r[a])}else n.merge(t[a],r[a],u-1,o);return t};n.mixin=function(e,t){n.merge(e.prototype,t.prototype)};n.inherit=function(e,t){function n(){}n.prototype=t.prototype;e.prototype=new n};n.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};n.intersect=function(e,t){var r=[],i=e.length>t.length?e:t,s=e.length>t.length?t:e;for(var o=0,u=s.length;o<u;o++)~n.indexOf(i,s[o])&&r.push(s[o]);return r};n.indexOf=function(e,t,n){for(var r=e.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n};n.toArray=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t};n.ua={};n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return e.withCredentials!=undefined}();n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)})("undefined"!=typeof io?io:module.exports,this);(function(e,t){function n(){}e.EventEmitter=n;n.prototype.on=function(e,n){this.$events||(this.$events={});this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n;return this};n.prototype.addListener=n.prototype.on;n.prototype.once=function(e,t){function r(){n.removeListener(e,r);t.apply(this,arguments)}var n=this;r.listener=t;this.on(e,r);return this};n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){var i=-1;for(var s=0,o=r.length;s<o;s++)if(r[s]===n||r[s].listener&&r[s].listener===n){i=s;break}if(i<0)return this;r.splice(i,1);r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this};n.prototype.removeAllListeners=function(e){if(e===undefined){this.$events={};return this}this.$events&&this.$events[e]&&(this.$events[e]=null);return this};n.prototype.listeners=function(e){this.$events||(this.$events={});this.$events[e]||(this.$events[e]=[]);t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]);return this.$events[e]};n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;var i=n.slice();for(var s=0,o=i.length;s<o;s++)i[s].apply(this,r)}return!0}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a instanceof Date&&(a=date(e));typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent;u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]";gap=o;return i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)if(typeof rep[n]=="string"){r=rep[n];i=str(r,a);i&&u.push(quote(r)+(gap?": ":":")+i)}}else for(r in a)if(Object.prototype.hasOwnProperty.call(a,r)){i=str(r,a);i&&u.push(quote(r)+(gap?": ":":")+i)}i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}";gap=o;return i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;gap="";indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")};JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)if(Object.prototype.hasOwnProperty.call(i,n)){r=walk(i,n);r!==undefined?i[n]=r:delete i[n]}return reviver.call(e,t,i)}var j;text=String(text);cx.lastIndex=0;cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}})("undefined"!=typeof io?io:module.exports,typeof JSON!="undefined"?JSON:undefined);(function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],s=n.advice=["reconnect"],o=t.JSON,u=t.util.indexOf;n.encodePacket=function(e){var t=u(r,e.type),n=e.id||"",a=e.endpoint||"",f=e.ack,l=null;switch(e.type){case"error":var c=e.reason?u(i,e.reason):"",h=e.advice?u(s,e.advice):"";if(c!==""||h!=="")l=c+(h!==""?"+"+h:"");break;case"message":e.data!==""&&(l=e.data);break;case"event":var p={name:e.name};e.args&&e.args.length&&(p.args=e.args);l=o.stringify(p);break;case"json":l=o.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}var d=[t,n+(f=="data"?"+":""),a];l!==null&&l!==undefined&&d.push(l);return d.join(":")};n.encodePayload=function(e){var t="";if(e.length==1)return e[0];for(var n=0,r=e.length;n<r;n++){var i=e[n];t+="�"+i.length+"�"+e[n]}return t};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(a);if(!t)return{};var n=t[2]||"",e=t[5]||"",u={type:r[t[1]],endpoint:t[4]||""};if(n){u.id=n;t[3]?u.ack="data":u.ack=!0}switch(u.type){case"error":var t=e.split("+");u.reason=i[t[0]]||"";u.advice=s[t[1]]||"";break;case"message":u.data=e||"";break;case"event":try{var f=o.parse(e);u.name=f.name;u.args=f.args}catch(l){}u.args=u.args||[];break;case"json":try{u.data=o.parse(e)}catch(l){}break;case"connect":u.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t){u.ackId=t[1];u.args=[];if(t[3])try{u.args=t[3]?o.parse(t[3]):[]}catch(l){}}break;case"disconnect":case"heartbeat":}return u};n.decodePayload=function(e){if(e.charAt(0)=="�"){var t=[];for(var r=1,i="";r<e.length;r++)if(e.charAt(r)=="�"){t.push(n.decodePacket(e.substr(r+1).substr(0,i)));r+=Number(i)+1;i=""}else i+=e.charAt(r);return t}return[n.decodePacket(e)]}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(e,t){function n(e,t){this.socket=e;this.sessid=t}e.Transport=n;t.util.mixin(n,t.EventEmitter);n.prototype.heartbeats=function(){return!0};n.prototype.onData=function(e){this.clearCloseTimeout();(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(e!==""){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this};n.prototype.onPacket=function(e){this.socket.setHeartbeatTimeout();if(e.type=="heartbeat")return this.onHeartbeat();e.type=="connect"&&e.endpoint==""&&this.onConnect();e.type=="error"&&e.advice=="reconnect"&&(this.isOpen=!1);this.socket.onPacket(e);return this};n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}};n.prototype.onDisconnect=function(){this.isOpen&&this.close();this.clearTimeouts();this.socket.onDisconnect();return this};n.prototype.onConnect=function(){this.socket.onConnect();return this};n.prototype.clearCloseTimeout=function(){if(this.closeTimeout){clearTimeout(this.closeTimeout);this.closeTimeout=null}};n.prototype.clearTimeouts=function(){this.clearCloseTimeout();this.reopenTimeout&&clearTimeout(this.reopenTimeout)};n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))};n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})};n.prototype.onOpen=function(){this.isOpen=!0;this.clearCloseTimeout();this.socket.onOpen()};n.prototype.onClose=function(){var e=this;this.isOpen=!1;this.socket.onClose();this.onDisconnect()};n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid};n.prototype.ready=function(e,t){t.call(this)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(e,t,n){function r(e){this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1};t.util.merge(this.options,e);this.connected=!1;this.open=!1;this.connecting=!1;this.reconnecting=!1;this.namespaces={};this.buffer=[];this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"beforeunload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r;t.util.mixin(r,t.EventEmitter);r.prototype.of=function(e){if(!this.namespaces[e]){this.namespaces[e]=new t.SocketNamespace(this,e);e!==""&&this.namespaces[e].packet({type:"connect"})}return this.namespaces[e]};r.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)if(this.namespaces.hasOwnProperty(t)){e=this.of(t);e.$emit.apply(e,arguments)}};r.prototype.handshake=function(e){function s(t){if(t instanceof Error){n.connecting=!1;n.onError(t.message)}else e.apply(null,t.split(":"))}var n=this,r=this.options,o=["http"+(r.secure?"s":"")+":/",r.host+":"+r.port,r.resource,t.protocol,t.util.query(this.options.query,"t="+ +(new Date))].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var u=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=o+"&jsonp="+t.j.length;u.parentNode.insertBefore(a,u);t.j.push(function(e){s(e);a.parentNode.removeChild(a)})}else{var f=t.util.request();f.open("GET",o,!0);this.isXDomain()&&(f.withCredentials=!0);f.onreadystatechange=function(){if(f.readyState==4){f.onreadystatechange=i;if(f.status==200)s(f.responseText);else if(f.status==403)n.onError(f.responseText);else{n.connecting=!1;!n.reconnecting&&n.onError(f.responseText)}}};f.send(null)}};r.prototype.getTransport=function(e){var n=e||this.transports,r;for(var i=0,s;s=n[i];i++)if(t.Transport[s]&&t.Transport[s].check(this)&&(!this.isXDomain()||t.Transport[s].xdomainCheck(this)))return new t.Transport[s](this,this.sessionid);return null};r.prototype.connect=function(e){if(this.connecting)return this;var n=this;n.connecting=!0;this.handshake(function(r,i,s,o){function u(e){n.transport&&n.transport.clearTimeouts();n.transport=n.getTransport(e);if(!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0;n.publish("connecting",n.transport.name);n.transport.open();n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected){n.connecting=!1;if(n.options["try multiple transports"]){var e=n.transports;while(e.length>0&&e.splice(0,1)[0]!=n.transport.name);e.length?u(e):n.publish("connect_failed")}}},n.options["connect timeout"]))})}n.sessionid=r;n.closeTimeout=s*1e3;n.heartbeatTimeout=i*1e3;n.transports||(n.transports=n.origTransports=o?t.util.intersect(o.split(","),n.options.transports):n.options.transports);n.setHeartbeatTimeout();u(n.transports);n.once("connect",function(){clearTimeout(n.connectTimeoutTimer);e&&typeof e=="function"&&e()})});return this};r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)};r.prototype.packet=function(e){this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e);return this};r.prototype.setBuffer=function(e){this.doBuffer=e;!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())};r.prototype.flushBuffer=function(){this.transport.payload(this.buffer);this.buffer=[]};r.prototype.disconnect=function(){if(this.connected||this.connecting){this.open&&this.of("").packet({type:"disconnect"});this.onDisconnect("booted")}return this};r.prototype.disconnectSync=function(){var e=t.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",n,!1);e.send(null);this.onDisconnect("booted")};r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e};r.prototype.onConnect=function(){if(!this.connected){this.connected=!0;this.connecting=!1;this.doBuffer||this.setBuffer(!1);this.emit("connect")}};r.prototype.onOpen=function(){this.open=!0};r.prototype.onClose=function(){this.open=!1;clearTimeout(this.heartbeatTimeoutTimer)};r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)};r.prototype.onError=function(e){if(e&&e.advice&&e.advice==="reconnect"&&(this.connected||this.connecting)){this.disconnect();this.options.reconnect&&this.reconnect()}this.publish("error",e&&e.reason?e.reason:e)};r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1;this.connecting=!1;this.open=!1;if(t||n){this.transport.close();this.transport.clearTimeouts();if(t){this.publish("disconnect",e);"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()}}};r.prototype.reconnect=function(){function i(){if(e.connected){for(var t in e.namespaces)e.namespaces.hasOwnProperty(t)&&""!==t&&e.namespaces[t].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer);e.removeListener("connect_failed",s);e.removeListener("connect",s);e.reconnecting=!1;delete e.reconnectionAttempts;delete e.reconnectionDelay;delete e.reconnectionTimer;delete e.redoTransports;e.options["try multiple transports"]=n}function s(){if(!e.reconnecting)return;if(e.connected)return i();if(e.connecting&&e.reconnecting)return e.reconnectionTimer=setTimeout(s,1e3);if(e.reconnectionAttempts++>=t)if(!e.redoTransports){e.on("connect_failed",s);e.options["try multiple transports"]=!0;e.transports=e.origTransports;e.transport=e.getTransport();e.redoTransports=!0;e.connect()}else{e.publish("reconnect_failed");i()}else{e.reconnectionDelay<r&&(e.reconnectionDelay*=2);e.connect();e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts);e.reconnectionTimer=setTimeout(s,e.reconnectionDelay)}}this.reconnecting=!0;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var e=this,t=this.options["max reconnection attempts"],n=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1;this.reconnectionTimer=setTimeout(s,this.reconnectionDelay);this.on("connect",s)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(e,t){function n(e,t){this.socket=e;this.name=t||"";this.flags={};this.json=new r(this,"json");this.ackPackets=0;this.acks={}}function r(e,t){this.namespace=e;this.name=t}e.SocketNamespace=n;t.util.mixin(n,t.EventEmitter);n.prototype.$emit=t.EventEmitter.prototype.emit;n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};n.prototype.packet=function(e){e.endpoint=this.name;this.socket.packet(e);this.flags={};return this};n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};if("function"==typeof t){n.id=++this.ackPackets;n.ack=!0;this.acks[n.id]=t}return this.packet(n)};n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};if("function"==typeof n){r.id=++this.ackPackets;r.ack="data";this.acks[r.id]=n;t=t.slice(0,t.length-1)}r.args=t;return this.packet(r)};n.prototype.disconnect=function(){if(this.name==="")this.socket.disconnect();else{this.packet({type:"disconnect"});this.$emit("disconnect")}return this};n.prototype.onPacket=function(e){function r(){n.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var n=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];e.ack=="data"?i.push(r):e.ack&&this.packet({type:"ack",ackId:e.id});this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);e.ack=="data"&&i.push(r);this.$emit.apply(this,i);break;case"ack":if(this.acks[e.ackId]){this.acks[e.ackId].apply(this,e.args);delete this.acks[e.ackId]}break;case"error":e.advice?this.socket.onError(e):e.reason=="unauthorized"?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}};r.prototype.send=function(){this.namespace.flags[this.name]=!0;this.namespace.send.apply(this.namespace,arguments)};r.prototype.emit=function(){this.namespace.flags[this.name]=!0;this.namespace.emit.apply(this.namespace,arguments)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(e,t,n){function r(e){t.Transport.apply(this,arguments)}e.websocket=r;t.util.inherit(r,t.Transport);r.prototype.name="websocket";r.prototype.open=function(){var e=t.util.query(this.socket.options.query),r=this,i;i||(i=n.MozWebSocket||n.WebSocket);this.websocket=new i(this.prepareUrl()+e);this.websocket.onopen=function(){r.onOpen();r.socket.setBuffer(!1)};this.websocket.onmessage=function(e){r.onData(e.data)};this.websocket.onclose=function(){r.onClose();r.socket.setBuffer(!0)};this.websocket.onerror=function(e){r.onError(e)};return this};t.util.ua.iDevice?r.prototype.send=function(e){var t=this;setTimeout(function(){t.websocket.send(e)},0);return this}:r.prototype.send=function(e){this.websocket.send(e);return this};r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this};r.prototype.close=function(){this.websocket.close();return this};r.prototype.onError=function(e){this.socket.onError(e)};r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n};r.xdomainCheck=function(){return!0};t.transports.push("websocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(e,t,n){function r(e){if(!e)return;t.Transport.apply(this,arguments);this.sendBuffer=[]}function i(){}e.XHR=r;t.util.inherit(r,t.Transport);r.prototype.open=function(){this.socket.setBuffer(!1);this.onOpen();this.get();this.setCloseTimeout();return this};r.prototype.payload=function(e){var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))};r.prototype.send=function(e){this.post(e);return this};r.prototype.post=function(e){function r(){if(this.readyState==4){this.onreadystatechange=i;t.posting=!1;this.status==200?t.socket.setBuffer(!1):t.onClose()}}function s(){this.onload=i;t.socket.setBuffer(!1)}var t=this;this.socket.setBuffer(!0);this.sendXHR=this.request("POST");n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=s:this.sendXHR.onreadystatechange=r;this.sendXHR.send(e)};r.prototype.close=function(){this.onClose();return this};r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +(new Date));n.open(e||"GET",this.prepareUrl()+r,!0);if(e=="POST")try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n};r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};r.check=function(e,r){try{var i=t.util.request(r),s=n.XDomainRequest&&i instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",u=n.location&&o!=n.location.protocol;if(i&&(!s||!u))return!0}catch(a){}return!1};r.xdomainCheck=function(e){return r.check(e,!0)}})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(e,t){function n(e){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n;t.util.inherit(n,t.Transport.XHR);n.prototype.name="htmlfile";n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio";this.doc.body.appendChild(e);this.iframe=this.doc.createElement("iframe");e.appendChild(this.iframe);var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date));this.iframe.src=this.prepareUrl()+r;t.util.on(window,"unload",function(){n.destroy()})};n.prototype._=function(e,t){this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(r){}};n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};n.prototype.close=function(){this.destroy();return t.Transport.XHR.prototype.close.call(this)};n.check=function(e){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&t.Transport.XHR.check(e)}catch(r){}return!1};n.xdomainCheck=function(){return!1};t.transports.push("htmlfile")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r;t.util.inherit(r,t.Transport.XHR);t.util.merge(r,t.Transport.XHR);r.prototype.name="xhr-polling";r.prototype.heartbeats=function(){return!1};r.prototype.open=function(){var e=this;t.Transport.XHR.prototype.open.call(e);return!1};r.prototype.get=function(){function t(){if(this.readyState==4){this.onreadystatechange=i;if(this.status==200){e.onData(this.responseText);e.get()}else e.onClose()}}function r(){this.onload=i;this.onerror=i;e.retryCounter=1;e.onData(this.responseText);e.get()}function s(){e.retryCounter++;!e.retryCounter||e.retryCounter>3?e.onClose():e.get()}if(!this.isOpen)return;var e=this;this.xhr=this.request();if(n.XDomainRequest&&this.xhr instanceof XDomainRequest){this.xhr.onload=r;this.xhr.onerror=s}else this.xhr.onreadystatechange=t;this.xhr.send(null)};r.prototype.onClose=function(){t.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}};r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})};t.transports.push("xhr-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(e,t,n){function i(e){t.Transport["xhr-polling"].apply(this,arguments);this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var r=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=i;t.util.inherit(i,t.Transport["xhr-polling"]);i.prototype.name="jsonp-polling";i.prototype.post=function(e){function a(){f();n.socket.setBuffer(!1)}function f(){n.iframe&&n.form.removeChild(n.iframe);try{u=document.createElement('<iframe name="'+n.iframeId+'">')}catch(e){u=document.createElement("iframe");u.name=n.iframeId}u.id=n.iframeId;n.form.appendChild(u);n.iframe=u}var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(!this.form){var i=document.createElement("form"),s=document.createElement("textarea"),o=this.iframeId="socketio_iframe_"+this.index,u;i.className="socketio";i.style.position="absolute";i.style.top="0px";i.style.left="0px";i.style.display="none";i.target=o;i.method="POST";i.setAttribute("accept-charset","utf-8");s.name="d";i.appendChild(s);document.body.appendChild(i);this.form=i;this.area=s}this.form.action=this.prepareUrl()+r;f();this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(l){}this.iframe.attachEvent?u.onreadystatechange=function(){n.iframe.readyState=="complete"&&a()}:this.iframe.onload=a;this.socket.setBuffer(!0)};i.prototype.get=function(){var e=this,n=document.createElement("script"),i=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}n.async=!0;n.src=this.prepareUrl()+i;n.onerror=function(){e.onClose()};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s);this.script=n;r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e);document.body.removeChild(e)},100)};i.prototype._=function(e){this.onData(e);this.isOpen&&this.get();return this};i.prototype.ready=function(e,n){var i=this;if(!r)return n.call(this);t.util.load(function(){n.call(i)})};i.check=function(){return"document"in n};i.xdomainCheck=function(){return!0};t.transports.push("jsonp-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);typeof define=="function"&&define.amd&&define([],function(){return io})})();notifications={create:function(e){var t=$("<div>",{"class":"notification"}).html(e).prependTo("#notifications");setTimeout(function(){$(t).animate({opacity:.001},function(){$(this).slideUp()})},3e3)}};sockets={connected:!1};var socket=io.connect(window.location.origin),pladdfail=function(e){$(".new-playlist-input").hide();var t=$("<div>",{"class":"playlist-addition-failed"}).text(e);t.prependTo(".playlists-menu").delay(3e3).slideUp()},pladded=function(e){$(".new-playlist-input").hide();$(".playlists-menu").prepend(e)};socket.on("connected",function(){sockets.connected=!0});socket.on("track-added",function(e){notifications.create(e.notification);var t=$('[data-route="/library"]  .extendedtable tbody');e.position=="top"?t.find(".song").eq(0).before(e.song):t.append(e.song);$('.song[data-id="'+$(e.song).attr("data-id")+'"]').addClass("in-library animated").removeClass("not-in-library")});socket.on("tracks-added",function(e){});socket.on("track-removed",function(e){notifications.create(e.notification);var t=$('[data-route="/library"]'),n=t.find('[data-id="'+e.id+'"]').remove()});socket.on("playlist-added",pladded);socket.on("playlist-renamed",pladded);socket.on("playlist-addition-failed",pladdfail);socket.on("playlist-renamed-failed",pladdfail);socket.on("playlist-removed",function(e){$("#sidebar [data-navigate='"+e.url+"']").remove()});socket.on("playlist-song-removed",function(e){var t=$('[data-route="'+e.view+'"]');t.find('[data-id="'+e.songid+'"]').remove();var n=t.find(".playlist-trackcount");console.log(e.view);var r=$("[data-url='"+e.view+"']").addClass("add-song-to-playlist-button not-in-playlist").removeClass("remove-song-from-playlist-button in-playlist contains-song").find(".song-page-playlist-trackcount").text(e.trackcount),i=t.find(".playlist-duration"),s=t.find(".playlist-plural-singular-tracks");$(n).text(e.trackcount);var o=parseFloat($(i).attr("data-duration"))+e.lengthdifference;$(i).text(helpers.parsehours(o)).attr("data-duration",o);$(s).text(e.trackslabel==1?"track":"tracks")});socket.on("playlist-song-added",function(e){var t=$('[data-route="'+e.view+'"]'),n=t.find("tbody"),r=t.find(".playlist-trackcount"),i=t.find(".playlist-duration");console.log(e.view);var s=$("[data-url='"+e.view+"']").removeClass("add-song-to-playlist-button not-in-playlist").addClass("remove-song-from-playlist-button in-playlist contains-song").find(".song-page-playlist-trackcount").text(e.trackcount),o=t.find(".playlist-plural-singular-tracks");e.position=="top"&&n.find(".song").length!=0?n.find(".song").eq(0).before(e.song):n.append(e.song);$(r).text(e.trackcount);var u=parseFloat($(i).attr("data-duration"))+e.lengthdifference;$(i).text(helpers.parsehours(u)).attr("data-duration",u);$(o).text(e.trackslabel==1?"track":"tracks")});(function(){var e="{{ a }}",t;if(e.split(/(\{\{.*?\}\})/).length===0){t=function(e,n,r){function c(){var e=1;for(e;e<arguments.length-2;e+=1)arguments[e]===undefined&&(a[e]=undefined)}if(Object.prototype.toString.call(n)!=="[object RegExp]")return t._nativeSplit.call(e,n,r);var i=[],s=0,o=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.sticky?"y":""),u,a,f,l;n=RegExp(n.source,o+"g");e=e.toString();t._compliantExecNpcg||(u=RegExp("^"+n.source+"$(?!\\s)",o));if(r===undefined||r<0)r=Infinity;else{r=Math.floor(+r);if(!r)return[]}a=n.exec(e);while(a){f=a.index+a[0].length;if(f>s){i.push(e.slice(s,a.index));!t._compliantExecNpcg&&a.length>1&&a[0].replace(u,c);a.length>1&&a.index<e.length&&Array.prototype.push.apply(i,a.slice(1));l=a[0].length;s=f;if(i.length>=r)break}n.lastIndex===a.index&&(n.lastIndex+=1);a=n.exec(e)}s===e.length?(l||!n.test(""))&&i.push(""):i.push(e.slice(s));return i.length>r?i.slice(0,r):i};t._compliantExecNpcg=/()??/.exec("")[1]===undefined;t._nativeSplit=String.prototype.split;String.prototype.split=function(e,n){return t(this,e,n)}}})();swig=function(){var e={},t={},n={},r={},i={},s={};(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};if(typeof exports!="undefined"){typeof module!="undefined"&&module.exports&&(exports=module.exports=x);exports._=x}else e._=x;x.VERSION="1.4.3";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];if(e==null)return r;if(h&&e.map===h)return e.map(t,n);T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)});return r};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p){r&&(t=x.bind(t,r));return i?e.reduce(t,n):e.reduce(t)}T(e,function(e,s,o){if(!i){n=e;i=!0}else n=t.call(r,n,e,s,o)});if(!i)throw new TypeError(N);return n};x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d){r&&(t=x.bind(t,r));return i?e.reduceRight(t,n):e.reduceRight(t)}var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s;if(!i){n=e[a];i=!0}else n=t.call(r,n,e[a],a,f)});if(!i)throw new TypeError(N);return n};x.find=x.detect=function(e,t,n){var r;C(e,function(e,i,s){if(t.call(n,e,i,s)){r=e;return!0}});return r};x.filter=x.select=function(e,t,n){var r=[];if(e==null)return r;if(v&&e.filter===v)return e.filter(t,n);T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)});return r};x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)};x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;if(e==null)return i;if(m&&e.every===m)return e.every(t,r);T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))
return n});return!!i};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;if(e==null)return i;if(g&&e.some===g)return e.some(t,r);T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n});return!!i};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})};x.invoke=function(e,t){var n=u.call(arguments,2);return x.map(e,function(e){return(x.isFunction(t)?t:e[t]).apply(e,n)})};x.pluck=function(e,t){return x.map(e,function(e){return e[t]})};x.where=function(e,t){return x.isEmpty(t)?[]:x.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})};x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})});return r.value};x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})});return r.value};x.shuffle=function(e){var t,n=0,r=[];T(e,function(e){t=x.random(n++);r[n-1]=r[t];r[t]=e});return r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)});return i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})};x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0);e[t]++})};x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s};x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]};x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length};x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]};x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))};x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]};x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)};x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)});return n};x.flatten=function(e,t){return A(e,t,[])};x.without=function(e){return x.difference(e,u.call(arguments,1))};x.uniq=x.unique=function(e,t,n,r){if(x.isFunction(t)){r=n;n=t;t=!1}var i=n?x.map(e,n,r):e,s=[],o=[];T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n)){o.push(n);s.push(e[r])}});return s};x.union=function(){return x.uniq(a.apply(r,arguments))};x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})};x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})};x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n};x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n};x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number"){r=x.sortedIndex(e,t);return e[r]===t?r:-1}r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1};x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1};x.range=function(e,t,n){if(arguments.length<=1){t=e||0;e=0}n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r){s[i++]=e;e+=n}return s};var O=function(){};x.bind=function(e,t){var n,r;if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;n=u.call(arguments,2);return r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}};x.bindAll=function(e){var t=u.call(arguments,1);t.length==0&&(t=x.functions(e));T(t,function(t){e[t]=x.bind(e[t],e)});return e};x.memoize=function(e,t){var n={};t||(t=x.identity);return function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}};x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)};x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))};x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date;i=null;s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);n=this;r=arguments;if(f<=0){clearTimeout(i);i=null;o=a;s=e.apply(n,r)}else i||(i=setTimeout(u,f));return s}};x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null;n||(i=e.apply(s,o))},a=n&&!r;clearTimeout(r);r=setTimeout(u,t);a&&(i=e.apply(s,o));return i}};x.once=function(e){var t=!1,n;return function(){if(t)return n;t=!0;n=e.apply(this,arguments);e=null;return n}};x.wrap=function(e,t){return function(){var n=[e];o.apply(n,arguments);return t.apply(this,n)}};x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}};x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}};x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t};x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t};x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t};x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t};x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()};x.extend=function(e){T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]});return e};x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));T(n,function(n){n in e&&(t[n]=e[n])});return t};x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t};x.defaults=function(e){T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])});return e};x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e};x.tap=function(e,t){t(e);return e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped);t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e);r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length;u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}n.pop();r.pop();return u};x.isEqual=function(e,t){return M(e,t,[],[])};x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0};x.isElement=function(e){return!!e&&e.nodeType===1};x.isArray=w||function(e){return f.call(e)=="[object Array]"};x.isObject=function(e){return e===Object(e)};T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}});x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")});typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"});x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))};x.isNaN=function(e){return x.isNumber(e)&&e!=+e};x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"};x.isNull=function(e){return e===null};x.isUndefined=function(e){return e===void 0};x.has=function(e,t){return l.call(e,t)};x.noConflict=function(){e._=t;return this};x.identity=function(e){return e};x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r};x.random=function(e,t){if(t==null){t=e;e=0}return e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}});x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n};x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];o.apply(e,arguments);return F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=""+ ++P;return e?e+t:t};x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){n=x.defaults({},n,x.templateSettings);var r=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]});n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'");r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'");o&&(s+="';\n"+o+"\n__p+='");i=u+t.length;return t});s+="';\n";n.variable||(s="with(obj||{}){\n"+s+"}\n");s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(n.variable||"obj","_",s)}catch(u){u.source=s;throw u}if(t)return o(t,x);var a=function(e){return o.call(this,e,x)};a.source="function("+(n.variable||"obj")+"){\n"+s+"}";return a};x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x);T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);(e=="shift"||e=="splice")&&n.length===0&&delete n[0];return F.call(this,n)}});T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}});x.extend(x.prototype,{chain:function(){this._chain=!0;return this},value:function(){return this._wrapped}})}).call(this);(function(e){function a(e){return{render:function(){return"<pre>"+e.stack+"</pre>"}}}function f(e){return new Function("_context","_parents","_filters","_","_ext",["_parents = _parents ? _parents.slice() : [];","_context = _context || {};","var j = _parents.length,",'  _output = "",',"  _this = this;","while (j--) {","   if (_parents[j] === this.id) {",'     return "Circular import of template " + this.id + " in " + _parents[_parents.length-1];',"   }","}","_parents.push(this.id);",e,"return _output;"].join(""))}function l(t,n){var r={compileFile:e.compileFile,blocks:{},type:i.TEMPLATE,id:n},s,u,l;if(o.allowErrors)s=i.parse.call(r,t,o.tags,o.autoescape);else try{s=i.parse.call(r,t,o.tags,o.autoescape)}catch(c){return new a(c)}r.tokens=s;u=i.compile.call(r);u!==!1?l=f(u):l=function(e,t,n,o,a){r.tokens=s;u=i.compile.call(r,"",e);var l=f(u);return l.call(this,e,t,n,o,a)};r.render=function(e,t){if(o.allowErrors)return l.call(this,e,t,o.filters,_,o.extensions);try{return l.call(this,e,t,o.filters,_,o.extensions)}catch(n){return new a(n)}};return r}function c(e,t){var n=t.filename||e;if(o.cache||t.cache){u.hasOwnProperty(n)||(u[n]=l(e,n));return u[n]}return l(e,n)}var r={allowErrors:!1,autoescape:!0,cache:!0,encoding:"utf8",filters:n,root:"/",tags:s,extensions:{},tzOffset:0},o=_.extend({},r),u={};e.init=function(e){u={};o=_.extend({},r,e);o.filters=_.extend(n,e.filters);o.tags=_.extend(s,e.tags);t.defaultTZOffset=o.tzOffset};e.compileFile=function(e,t){var n,i;if(o.cache&&u.hasOwnProperty(e))return u[e];if(typeof window!="undefined")throw new a({stack:"You must pre-compile all templates in-browser. Use `swig.compile(template);`."});i=function(){var t,i,s;i=function(i){var s=/^\//.test(e)||/^.:/.test(e)?e:i+"/"+e,o;try{o=fs.readFileSync(s,r.encoding);n=c(o,{filename:e})}catch(u){t=u}};typeof o.root=="string"&&i(o.root);if(o.root instanceof Array){s=0;while(n===undefined&&s<o.root.length){i(o.root[s]);s+=1}}if(n===undefined)throw t};if(o.allowErrors||t)i();else try{i()}catch(s){n=new a(s)}return n};e.compile=function(e,t){var n=c(e,t||{});return function(e,t){return n.render(e,t)}}})(e);(function(e){function r(e){return e.replace(/^\s+|\s+$/g,"")}function s(e){var t=[],n="",r=0;for(r;r<e.length;r+=1){if(!(!e[r]||e[r].charAt(0)===e[r].charAt(e[r].length-1)||e[r].indexOf('"')!==0&&e[r].indexOf("'")!==0)){n=e[r];continue}if(e[r]==="."&&n){n+=".";continue}if(e[r].indexOf('"')===e[r].length-1||e[r].indexOf("'")===e[r].length-1){n+=e[r];t.push(n);n=""}else t.push(e[r])}return _.compact(t)}function o(t,n){if(_.isArray(t))return"(true)";t=t.replace(/^this/,"_this.__currentContext");if(e.isLiteral(t))return"(true)";var r=t.split(/(\.|\[|\])/),i="",o=[],u=!1,a=!1;typeof n=="string"&&n.length&&r.unshift(n);r=_.reject(r,function(e){return e===""});r=s(r);_.each(r,function(t){if(t==="."){a=!0;return}if(t==="["){u=!0;return}if(t==="]"){u=!1;return}if(!i)i=t;else if(u)if(!e.isStringLiteral(t)){if(a){o[o.length-1]=_.last(o).replace(/\] !== "undefined"$/,"_"+t+'] !== "undefined"');i=i.replace(/\]$/,"_"+t+"]");return}i+="[___"+t+"]"}else i+="["+t+"]";else i+="."+t;a=!1;o.push("typeof "+i+' !== "undefined"')});return"("+o.join(" && ")+")"}var t=/^(Array|ArrayBuffer|Boolean|Date|Error|eval|EvalError|Function|Infinity|Iterator|JSON|Math|Namespace|NaN|Number|Object|QName|RangeError|ReferenceError|RegExp|StopIteration|String|SyntaxError|TypeError|undefined|uneval|URIError|XML|XMLList|break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|with)(?=(\.|$))/;e.isStringLiteral=function(e){if(typeof e!="string")return!1;var t=e.substring(0,1),n=e.charAt(e.length-1,1),r;if(t===n&&(t==="'"||t==='"')){r=e.substr(1,e.length-2).split("").reverse().join("");if(t==="'"&&/'(?!\\)/.test(r)||n==='"'&&/"(?!\\)/.test(r))throw new Error("Invalid string literal. Unescaped quote ("+e[0]+") found.");return!0}return!1};e.isLiteral=function(t){var n=!1;/^\d+([.]\d+)?$/.test(t)?n=!0:e.isStringLiteral(t)&&(n=!0);return n};e.isValidName=function(e){return typeof e=="string"&&e.substr(0,2)!=="__"&&/^([$A-Za-z_]+[$A-Za-z_0-9]*)(\.?([$A-Za-z_]+[$A-Za-z_0-9]*))*$/.test(e)&&!t.test(e)};e.isValidShortName=function(e){return e.substr(0,2)!=="__"&&/^[$A-Za-z_]+[$A-Za-z_0-9]*$/.test(e)&&!t.test(e)};e.isValidBlockName=function(e){return/^[A-Za-z]+[A-Za-z_0-9]*$/.test(e)};e.stripWhitespace=r;e.check=o;e.escapeVarName=function(t,n){if(_.isArray(t)){_.each(t,function(r,i){t[i]=e.escapeVarName(r,n)});return t}t=t.replace(/^this/,"_this.__currentContext");if(e.isLiteral(t))return t;typeof n=="string"&&n.length&&(t=n+"."+t);var r="",i=t.split(/(\.|\[|\])/),o=!1,u=!1;i=_.reject(i,function(e){return e===""});i=s(i);_.each(i,function(t){if(t==="."){u=!0;return}if(t==="["){o=!0;return}if(t==="]"){o=!1;return}r?o?e.isStringLiteral(t)?r+="["+t+"]":u?r=r.replace(/\]$/,"_"+t+"]"):r+="[___"+t+"]":r+="."+t:r=t;u=!1});return r};e.wrapMethod=function(t,n,r){var s="(function () {\n",o;t=t||'""';if(!n)return t;o=n.args.split(",");o=_.map(o,function(t){var n,r=t.replace(/^\s+|\s+$/g,"");try{n="__"+i.parseVariable(r).name.replace(/\W/g,"_")}catch(o){return t}if(e.isValidName(r)){s+=e.setVar(n,i.parseVariable(r));return n}return t});o=o&&o.length?o.join(","):'""';s+="return ";s+=r?r+'["':"";s+=n.name;s+=r?'"]':"";s+=".call(this";s+=o.length?", "+o:"";s+=");\n";return s+"})()"};e.wrapFilter=function(t,r){var i="",s="";t=t||'""';if(!r)return t;if(!n.hasOwnProperty(r.name))throw new Error('Filter "'+r.name+'" not found');s=r.args?t+", "+r.args:t;i+=e.wrapMethod(t,{name:r.name,args:s},"_filters");return i};e.wrapFilters=function(t,n,r,i){var s=e.escapeVarName(t,r);n&&n.length>0&&_.each(n,function(t){switch(t.name){case"raw":i=!1;return;case"e":case"escape":i=t.args||i;return;default:s=e.wrapFilter(s,t,"_filters")}});s=s||'""';i&&(s="_filters.escape.call(this, "+s+", "+i+")");return s};e.setVar=function(t,n){var r="",i,s,u;if(/\[/.test(n.name)){i=n.name.split(/(\[|\])/);s=[];u=!1;_.each(i,function(t){if(t==="")return;if(t==="["){u=!0;return}if(t==="]"){u=!1;return}u&&!e.isStringLiteral(t)&&(r+=e.setVar("___"+t.replace(/\W/g,"_"),{name:t,filters:[],escape:!0}))})}r+="var "+t+' = "";\n'+"if ("+o(n.name,"_context")+") {\n"+"  "+t+" = "+e.wrapFilters(n.name,n.filters,"_context",n.escape)+";\n"+"} else if ("+o(n.name)+") {\n"+"  "+t+" = "+e.wrapFilters(n.name,n.filters,null,n.escape)+";\n"+"}\n";if(n.filters.length){r+=" else if (true) {\n";r+="  "+t+" = "+e.wrapFilters("",n.filters,null,n.escape)+";\n";r+="}\n"}return r};e.parseIfArgs=function(t,n){var r=["==","<",">","!=","<=",">=","===","!==","&&","||","in","and","or","mod","%"],i="Bad if-syntax in `{% if "+t.join(" ")+" %}...",s=/^\(+/,o=/\)+$/,u=[],a,f,l=0;_.each(t,function(t,c){var h=0,p=0,d;if(s.test(t)){p=t.match(s)[0].length;l+=p;t=t.replace(s,"");while(p){p-=1;u.push({type:"separator",value:"("})}}if(/^\![^=]/.test(t)||t==="not"){t==="not"?t="":t=t.substr(1);u.push({type:"operator",value:"!"})}if(o.test(t)&&t.indexOf("(")===-1){if(!l)throw new Error(i);h=t.match(o)[0].length;t=t.replace(o,"");l-=h}if(t==="in"){f=u.pop();a="inindex"}else if(_.indexOf(r,t)!==-1){if(a==="operator")throw new Error(i);t=t.replace("and","&&").replace("or","||").replace("mod","%");u.push({value:t});a="operator"}else if(t!==""){if(a==="value")throw new Error(i);d=n.parseVariable(t);if(a==="inindex"){u.push({preout:f.preout+e.setVar("__op"+c,d),value:"(((_.isArray(__op"+c+") || typeof __op"+c+' === "string") && _.indexOf(__op'+c+", "+f.value+") !== -1) || (typeof __op"+c+' === "object" && '+f.value+" in __op"+c+"))"});f=null}else u.push({preout:e.setVar("__op"+c,d),value:"__op"+c});a="value"}while(h){h-=1;u.push({type:"separator",value:")"})}});if(l>0)throw new Error(i);return u}})(r);(function(e){var t={full:["January","February","March","April","May","June","July","August","September","October","November","December"],abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},n={full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],alt:{"-1":"Yesterday",0:"Today",1:"Tomorrow"}};e.defaultTZOffset=0;e.DateZ=function(){function i(e){return e<10?"0"+e:e}function s(){var e=i(Math.floor(Math.abs(n.timezoneOffset)/60)),t=i(Math.abs(n.timezoneOffset)-e*60),r=n.timezoneOffset<0?"+":"-",s=n.tzAbbreviation===undefined?"":" ("+n.tzAbbreviation+")";return"GMT"+r+e+t+s}var t={"default":["getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","toISOString","toGMTString","toUTCString","valueOf","getTime"],z:["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getYear","toDateString","toLocaleDateString","toLocaleTimeString"],string:["toLocaleString","toString","toTimeString"],zSet:["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setYear"],set:["setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds"],"static":["UTC","parse"]},n=this,r;n.date=n.dateZ=arguments.length>1?new Date(Date.UTC.apply(Date,arguments)+(new Date).getTimezoneOffset()*6e4):arguments.length===1?new Date(new Date(arguments[0])):new Date;n.timezoneOffset=n.dateZ.getTimezoneOffset();_.each(t.z,function(e){n[e]=function(){return n.dateZ[e]()}});_.each(t.string,function(e){n[e]=function(){return n.dateZ[e].apply(n.dateZ,[]).replace(/GMT[+\-]\\d{4} \\(([a-zA-Z]{3,4})\\)/,s())}});_.each(t["default"],function(e){n[e]=function(){return n.date[e]()}});_.each(t["static"],function(e){n[e]=function(){return Date[e].apply(Date,arguments)}});_.each(t.zSet,function(e){n[e]=function(){n.dateZ[e].apply(n.dateZ,arguments);n.date=new Date(n.dateZ.getTime()-n.dateZ.getTimezoneOffset()*6e4+n.timezoneOffset*6e4);return n}});_.each(t.set,function(e){n[e]=function(){n.date[e].apply(n.date,arguments);n.dateZ=new Date(n.date.getTime()+n.date.getTimezoneOffset()*6e4-n.timezoneOffset*6e4);return n}});e.defaultTZOffset&&this.setTimezoneOffset(e.defaultTZOffset)};e.DateZ.prototype={getTimezoneOffset:function(){return this.timezoneOffset},setTimezoneOffset:function(e,t){this.timezoneOffset=e;t&&(this.tzAbbreviation=t);this.dateZ=new Date(this.date.getTime()+this.date.getTimezoneOffset()*6e4-this.timezoneOffset*6e4);return this}};e.d=function(e){return(e.getDate()<10?"0":"")+e.getDate()};e.D=function(e){return n.abbr[e.getDay()]};e.j=function(e){return e.getDate()};e.l=function(e){return n.full[e.getDay()]};e.N=function(e){var t=e.getDay();return t>=1?t+1:7};e.S=function(e){var t=e.getDate();return t%10===1&&t!==11?"st":t%10===2&&t!==12?"nd":t%10===3&&t!==13?"rd":"th"};e.w=function(e){return e.getDay()};e.z=function(t,n,r){var i=t.getFullYear(),s=new e.DateZ(i,t.getMonth(),t.getDate(),12,0,0),o=new e.DateZ(i,0,1,12,0,0);s.setTimezoneOffset(n,r);o.setTimezoneOffset(n,r);return Math.round((s-o)/864e5)};e.W=function(e){var t=new Date(e.valueOf()),n=(e.getDay()+6)%7,r;t.setDate(t.getDate()-n+3);r=t.valueOf();t.setMonth(0,1);t.getDay()!==4&&t.setMonth(0,1+(4-t.getDay()+7)%7);return 1+Math.ceil((r-t)/6048e5)};e.F=function(e){return t.full[e.getMonth()]};e.m=function(e){return(e.getMonth()<9?"0":"")+(e.getMonth()+1)};e.M=function(e){return t.abbr[e.getMonth()]};e.n=function(e){return e.getMonth()+1};e.t=function(e){return 32-(new Date(e.getFullYear(),e.getMonth(),32)).getDate()};e.L=function(e){return(new Date(e.getFullYear(),1,29)).getDate()===29};e.o=function(e){var t=new Date(e.valueOf());t.setDate(t.getDate()-(e.getDay()+6)%7+3);return t.getFullYear()};e.Y=function(e){return e.getFullYear()};e.y=function(e){return e.getFullYear().toString().substr(2)};e.a=function(e){return e.getHours()<12?"am":"pm"};e.A=function(e){return e.getHours()<12?"AM":"PM"};e.B=function(e){var t=e.getUTCHours(),n;t=t===23?0:t+1;n=Math.abs(((t*60+e.getUTCMinutes())*60+e.getUTCSeconds())/86.4).toFixed(0);return"000".concat(n).slice(n.length)};e.g=function(e){var t=e.getHours();return t===0?12:t>12?t-12:t};e.G=function(e){return e.getHours()};e.h=function(e){var t=e.getHours();return(t<10||12<t&&22>t?"0":"")+(t<12?t:t-12)};e.H=function(e){var t=e.getHours();return(t<10?"0":"")+t};e.i=function(e){var t=e.getMinutes();return(t<10?"0":"")+t};e.s=function(e){var t=e.getSeconds();return(t<10?"0":"")+t};e.O=function(e){var t=e.getTimezoneOffset();return(t<0?"-":"+")+(t/60<10?"0":"")+t/60+"00"};e.Z=function(e){return e.getTimezoneOffset()*60};e.c=function(e){return e.toISOString()};e.r=function(e){return e.toUTCString()};e.U=function(e){return e.getTime()/1e3}})(t);(function(e){e.add=function(e,t){return _.isArray(e)&&_.isArray(t)?e.concat(t):typeof e=="object"&&typeof t=="object"?_.extend(e,t):_.isNumber(e)&&_.isNumber(t)?e+t:e+t};e.addslashes=function(t){if(typeof t=="object"){_.each(t,function(n,r){t[r]=e.addslashes(n)});return t}return t.replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\"/g,'\\"')};e.capitalize=function(t){if(typeof t=="object"){_.each(t,function(n,r){t[r]=e.capitalize(n)});return t}return t.toString().charAt(0).toUpperCase()+t.toString().substr(1).toLowerCase()};e.date=function(e,n,r,i){var s=n.length,o=new t.DateZ(e),u,a=0,f="";r&&o.setTimezoneOffset(r,i);for(a;a<s;a+=1){u=n.charAt(a);t.hasOwnProperty(u)?f+=t[u](o,r,i):f+=u}return f};e["default"]=function(e,t){return typeof e=="undefined"||!e&&typeof e!="number"?t:e};e.escape=e.e=function(e,t){t=t||"html";if(typeof e=="string"){if(t==="js"){var n=0,r,i="";e=e.replace(/\\/g,"\\u005C");for(n;n<e.length;n+=1){r=e.charCodeAt(n);if(r<32){r=r.toString(16).toUpperCase();r=r.length<2?"0"+r:r;i+="\\u00"+r}else i+=e[n]}return i.replace(/&/g,"\\u0026").replace(/</g,"\\u003C").replace(/>/g,"\\u003E").replace(/\'/g,"\\u0027").replace(/"/g,"\\u0022").replace(/\=/g,"\\u003D").replace(/-/g,"\\u002D").replace(/;/g,"\\u003B")}return e.replace(/&(?!amp;|lt;|gt;|quot;|#39;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}return e};e.first=function(e){return typeof e=="object"&&!_.isArray(e)?"":typeof e=="string"?e.substr(0,1):_.first(e)};e.join=function(e,t){if(_.isArray(e))return e.join(t);if(typeof e=="object"){var n=[];_.each(e,function(e,t){n.push(e)});return n.join(t)}return e};e.json_encode=function(e,t){return JSON.stringify(e,null,t||0)};e.last=function(e){return typeof e=="object"&&!_.isArray(e)?"":typeof e=="string"?e.charAt(e.length-1):_.last(e)};e.length=function(e){return typeof e=="object"?_.keys(e).length:e.length};e.lower=function(t){if(typeof t=="object"){_.each(t,function(n,r){t[r]=e.lower(n)});return t}return t.toString().toLowerCase()};e.replace=function(e,t,n,r){var i=new RegExp(t,r);return e.replace(i,n)};e.reverse=function(e){return _.isArray(e)?e.reverse():e};e.striptags=function(t){if(typeof t=="object"){_.each(t,function(n,r){t[r]=e.striptags(n)});return t}return t.toString().replace(/(<([^>]+)>)/gi,"")};e.title=function(t){if(typeof t=="object"){_.each(t,function(n,r){t[r]=e.title(n)});return t}return t.toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};e.uniq=function(e){return _.uniq(e)};e.upper=function(t){if(typeof t=="object"){_.each(t,function(n,r){t[r]=e.upper(n)});return t}return t.toString().toUpperCase()};e.url_encode=function(e){return encodeURIComponent(e)};e.url_decode=function(e){return decodeURIComponent(e)}})(n);(function(e){function a(e){return r.stripWhitespace(e).match(/^[\w\.]+/)[0]}function f(e){return e.replace(/\\/g,"\\\\")}function l(e){return f(r.stripWhitespace(e).replace(/^[\w\.]+\(|\)$/g,""))}function c(e,t){var n=e.split(".");while(n.length)t=t[n.splice(0,1)[0]];return t}function h(e,t){function u(e,n){var r=new RegExp("\\"+n+"$"),i=e,s="";while(!r.test(s)&&i<t.length){s+=" "+t[i];t[i]=null;i+=1}if(!r.test(s))throw new Error("Malformed arguments "+s+" sent to tag.");return s.replace(/^ /,"")}t=_.map(t,f);var n=0,r=t.length,i,s,o=[];for(n;n<r;n+=1){i=t[n];if(i===null||/^\s+$/.test(i))continue;if(/^\"/.test(i)&&!/\"[\]\}]?$/.test(i)||/^\'/.test(i)&&!/\'[\]\}]?$/.test(i)||/^\{/.test(i)&&!/\}$/.test(i)||/^\[/.test(i)&&!/\]$/.test(i)){switch(i.substr(0,1)){case"'":s="'";break;case'"':s='"';break;case"[":s="]";break;case"{":s="}"}o.push(u(n,s));continue}o.push(i)}return o}function p(e,t){_.each(e.tokens,function(e,n){if(e.name==="block"){t[e.args[0]]=e;p(e,t)}})}function d(e){var t;e.parentBlock?t=e.parentBlock:e.parent&&(t=d(_.last(e.parent)));return t}function v(e,t){var n,i,u=[];if(this.type===s){_.each(this.tokens,function(e,s){if(!i)if(e.name==="extends"){n=e.args[0];if(!r.isStringLiteral(n)){if(!t){i=!0;return}n='"'+c(n,t)+'"'}if(!r.isStringLiteral(n)||e.args.length>1)throw new Error("Extends tag on line "+e.line+" accepts exactly one string literal as an argument.");if(s>0)throw new Error('Extends tag must be the first tag in the template, but "extends" found on line '+e.line+".");e.template=this.compileFile(n.replace(/['"]/g,""),!0);this.parent=e.template;this.blocks=_.extend({},this.parent.blocks,this.blocks)}else if(e.name==="block"){var a=e.args[0],f;if(!r.isValidBlockName(a)||e.args.length!==1)throw new Error('Invalid block tag name "'+a+'" on line '+e.line+".");this.blocks[a]=e;p(e,this.blocks);if(this.parent){e.parentBlock=this.parent.blocks[a];f=_.indexOf(this.parent.tokens,this.parent.blocks[a]);f>=0&&(this.parent.tokens[f]=e)}}else e.type===o&&u.push(e)},this);if(i)return!1;this.parent&&this.parent.tokens&&(this.tokens=u.concat(this.parent.tokens))}}var t=/^\{\{[^\r]*?\}\}$/,n=/^\{%[^\r]*?%\}$/,i=/^\{#[^\r]*?#\}$/,s=e.TEMPLATE=0,o=1,u=2;e.TOKEN_TYPES={TEMPLATE:s,LOGIC:o,VAR:u};e.parseVariable=function(e,t){if(!e)return{type:null,name:"",filters:[],escape:t};var n=[],r=e.replace(/^\{\{\s*|\s*\}\}$/g,"").split("|"),i=r.shift(),s=null,o;if(/\(/.test(i)){s=l(i.replace(/^\w+\./,""));i=a(i)}_.each(r,function(e,t){if(e&&(/^[\w\.]+\(/.test(e)||/\)$/.test(e))&&!/^[\w\.]+\([^\)]*\)$/.test(e)){r[t]+=r[t+1]?"|"+r[t+1]:"";r[t+1]=!1}});r=_.without(r,!1);_.each(r,function(e){var t=a(e);/\(/.test(e)?n.push({name:t,args:l(e)}):n.push({name:t,args:""})});return{type:u,name:i,args:s,filters:n,escape:t}};e.parse=function(s,u,a){var f=r.stripWhitespace(s).split(/(\{%[^\r]*?%\}|\{\{.*?\}\}|\{#[^\r]*?#\})/),l=!!a,c=l,p=[[]],d=0,v=0,m=f.length,g,y,b,w=1,E=1,S=null,x,T=/^\{\% *raw *\%\}/,N=/\{\% *endraw *\%\}$/,C=!1,k=!1,L=!1,A=!1,O=!1;for(v;v<m;v+=1){g=f[v];E=w;S=g.match(/\n/g);k=!1;L=!1;A=!1;O=!1;S&&(w+=S.length);if(C!==!1&&!N.test(g)){C+=g;continue}if(g.length===0||i.test(g))continue;if(/^\s+$/.test(g))g=g.replace(/ +/," ").replace(/\n+/,"\n");else if(t.test(g))g=e.parseVariable(g,l);else if(n.test(g)){if(N.test(g)){g=C+g.replace(N,"");C=!1;p[d].push(g);continue}if(T.test(g)){C=g.replace(T,"");continue}y=g.replace(/^\{%\s*|\s*%\}$/g,"").split(" ");if(y[0]==="-"){L=!0;y.shift()}b=y.shift();if(_.last(y)==="-"){k=!0;y.pop()}if(d>0&&/^end/.test(b)){x=_.last(p[p.length-2]);if("end"+x.name===b){x.name==="autoescape"&&(l=c);x.strip.end=L;x.strip.after=k;p.pop();d-=1;continue}throw new Error('Expected end tag for "'+x.name+'", but found "'+b+'" at line '+w+".")}if(!u.hasOwnProperty(b))throw new Error("Unknown logic tag at line "+w+': "'+b+'".');if(b==="autoescape"){c=l;l=!y.length||y[0]==="true"?y.length>=2?y[1]:!0:!1}g={type:o,line:E,name:b,compile:u[b],parent:_.uniq(p[p.length-2]||[]),strip:{before:L,after:k,start:!1,end:!1}};g.args=h(g,y);if(u[b].ends){g.strip.after=!1;g.strip.start=k;p[d].push(g);p.push(g.tokens=[]);d+=1;continue}}p[d].push(g)}if(C!==!1)throw new Error('Missing expected end tag for "raw" on line '+E+".");if(d!==0){x=_.last(p[p.length-2]);throw new Error('Missing end tag for "'+x.name+'" that was opened on line '+x.line+".")}return p[d]};e.compile=function m(t,n,i){var a="",l,c,h;t=t||"";this.type===s&&(i=this);this.blocks||(this.blocks={});if(v.call(this,t,n)===!1)return!1;_.each(this.tokens,function(s,p){var v,g,y,b,w;if(typeof s=="string"){b=this.tokens[p-1];w=this.tokens[p+1];b&&b.strip&&b.strip.after&&(s=s.replace(/^\s+/,""));w&&w.strip&&w.strip.before&&(s=s.replace(/\s+$/,""));a+='_output += "'+f(s).replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/"/g,'\\"')+'";\n';return a}if(typeof s!="object")return;if(s.type===u){v=s.name.replace(/\W/g,"_");g=r.isLiteral(v)?'["'+v+'"]':"."+v;y=s.args&&s.args.length?s.args:"";a+='if (typeof _context !== "undefined" && typeof _context'+g+' === "function") {\n';l=r.wrapMethod("",{name:v,args:y},"_context");a+='  _output = (typeof _output === "undefined") ? '+l+": _output + "+l+";\n";if(r.isValidName(v)){a+="} else if (typeof "+v+' === "function") {\n';l=r.wrapMethod("",{name:v,args:y});a+='  _output = (typeof _output === "undefined") ? '+l+": _output + "+l+";\n"}a+="} else {\n";a+=r.setVar("__"+v,s);a+='  _output = (typeof _output === "undefined") ? __'+v+": _output + __"+v+";\n";a+="}\n"}if(s.type!==o)return;if(s.name==="block"){c=s.args[0];if(!i.blocks.hasOwnProperty(c))throw new Error('Unrecognized nested block.  Block "'+c+'" at line '+s.line+' of "'+i.id+'" is not in template block list.');a+=m.call(i.blocks[s.args[0]],t+"  ",n,i)}else if(s.name==="parent"){h=d(s);if(!h)throw new Error("No parent block found for parent tag at line "+s.line+"."
);a+=m.call(h,t+"  ",n)}else if(s.hasOwnProperty("compile")){s.strip.start&&s.tokens.length&&typeof s.tokens[0]=="string"&&(s.tokens[0]=s.tokens[0].replace(/^\s+/,""));s.strip.end&&s.tokens.length&&typeof _.last(s.tokens)=="string"&&(s.tokens[s.tokens.length-1]=_.last(s.tokens).replace(/\s+$/,""));a+=s.compile(t+"  ",e)}else a+=m.call(s,t+"  ",n)},this);return a}})(i);s.autoescape=function(){module={};module.exports=function(e,t){return t.compile.apply(this,[e])};module.exports.ends=!0;return module.exports}();s.block=function(){module={};module.exports={ends:!0};return module.exports}();s["else"]=function(){module={};module.exports=function(e,t){var n=_.last(this.parent).name,i=_.clone(this.args),s,o,u;if(n==="for"){if(i.length)throw new Error('"else" tag cannot accept arguments in the "for" context.');return"} if (__loopLength === 0) {\n"}if(n!=="if")throw new Error('Cannot call else tag outside of "if" or "for" context.');s=i.shift();o=r.parseIfArgs(i,t);u="";if(s){u+="} else if (\n";u+="  (function () {\n";_.each(o,function(e){e.hasOwnProperty("preout")&&e.preout&&(u+=e.preout+"\n")});u+="return (\n";_.each(o,function(e){u+=e.value+" "});u+=");\n";u+="  })()\n";u+=") {\n";return u}return e+"\n} else {\n"};return module.exports}();s["extends"]=function(){module={};module.exports={};return module.exports}();s.filter=function(){module={};module.exports=function(e,t){var n=_.clone(this.args),i=n.shift(),s=n.length?n.join(", "):"",o="(function () {\n";o+='  var _output = "";\n';o+=t.compile.apply(this,[e+"  "])+"\n";o+="  return _output;\n";o+="})()\n";return"_output += "+r.wrapFilter(o.replace(/\n/g,""),{name:i,args:s})+";\n"};module.exports.ends=!0;return module.exports}();s["for"]=function(){module={};module.exports=function(e,t){var n=_.clone(this.args),i=n[0],s=n[1],o=t.parseVariable(n[2]),u="",a;e=e||"";if(typeof s!="undefined"&&s!=="in")throw new Error('Invalid syntax in "for" tag');if(!r.isValidShortName(i))throw new Error("Invalid arguments ("+i+') passed to "for" tag');if(!r.isValidName(o.name))throw new Error("Invalid arguments ("+o.name+') passed to "for" tag');i=r.escapeVarName(i);a='loop.index = __loopIndex + 1;\nloop.index0 = __loopIndex;\nloop.revindex = __loopLength - loop.index0;\nloop.revindex0 = loop.revindex - 1;\nloop.first = (__loopIndex === 0);\nloop.last = (__loopIndex === __loopLength - 1);\n_context["'+i+'"] = __loopIter[loop.key];\n'+t.compile.apply(this,[e+"   "]);u='(function () {\n  var loop = {}, __loopKey, __loopIndex = 0, __loopLength = 0, __keys = [],    __ctx_operand = _context["'+i+'"],\n'+"    loop_cycle = function() {\n"+"      var args = _.toArray(arguments), i = loop.index0 % args.length;\n"+"      return args[i];\n"+"    };\n"+r.setVar("__loopIter",o)+"  else {\n"+"    return;\n"+"  }\n"+"  if (_.isArray(__loopIter)) {\n"+"    __loopIndex = 0; __loopLength = __loopIter.length;\n"+"    for (; __loopIndex < __loopLength; __loopIndex += 1) {\n"+"       loop.key = __loopIndex;\n"+a+"    }\n"+'  } else if (typeof __loopIter === "object") {\n'+"    __keys = _.keys(__loopIter);\n"+"    __loopLength = __keys.length;\n"+"    __loopIndex = 0;\n"+"    for (; __loopIndex < __loopLength; __loopIndex += 1) {\n"+"       loop.key = __keys[__loopIndex];\n"+a+"    }\n"+"  }\n"+'  _context["'+i+'"] = __ctx_operand;\n'+"})();\n";return u};module.exports.ends=!0;return module.exports}();s["if"]=function(){module={};module.exports=function(e,t){var n=_.clone(this.args),i=r.parseIfArgs(n,t),s="(function () {\n";_.each(i,function(e){e.hasOwnProperty("preout")&&e.preout&&(s+=e.preout+"\n")});s+="\nif (\n";_.each(i,function(e){s+=e.value+" "});s+=") {\n";s+=t.compile.apply(this,[e+"  "]);s+="\n}\n";s+="})();\n";return s};module.exports.ends=!0;return module.exports}();s["import"]=function(){module={};module.exports=function(e,t){this.args.length!==3;var n=_.clone(this.args),i=n[0],s=n[1],o=n[2],u="";if(!r.isLiteral(i)&&!r.isValidName(i))throw new Error('Invalid attempt to import "'+i+'".');if(s!=="as")throw new Error('Invalid syntax {% import "'+i+'" '+s+" "+o+" %}");u+="_.extend(_context, (function () {\n";u+='var _context = {}, __ctx = {}, _output = "";\n'+r.setVar("__template",t.parseVariable(i))+"_this.compileFile(__template).render(__ctx, _parents);\n"+"_.each(__ctx, function (item, key) {\n"+'  if (typeof item === "function") {\n'+'    _context["'+o+'_" + key] = item;\n'+"  }\n"+"});\n"+"return _context;\n";u+="})());\n";return u};return module.exports}();s.include=function(){module={};module.exports=function(e,t){var n=_.clone(this.args),i=n.shift(),s="_context",o=!1,u="",a;e=e||"";if(!r.isLiteral(i)&&!r.isValidName(i))throw new Error("Invalid arguments passed to 'include' tag.");if(n.length){if(_.last(n)==="only"){s="{}";n.pop()}if(n.length>1&&n[0]==="ignore"&n[1]==="missing"){n.shift();n.shift();o=!0}if(n.length&&n[0]!=="with")throw new Error("Invalid arguments passed to 'include' tag.");if(n[0]==="with"){n.shift();if(!n.length)throw new Error("Context for 'include' tag not provided, but expected after 'with' token.");a=n.shift();s='_context["'+a+'"] || '+a}}u="(function () {\n"+r.setVar("__template",t.parseVariable(i))+"\n"+"  var includeContext = "+s+";\n";o&&(u+="try {\n");u+='  if (typeof __template === "string") {\n';u+="    _output += _this.compileFile(__template).render(includeContext, _parents);\n";u+="  }\n";o&&(u+="} catch (e) {}\n");u+="})();\n";return u};return module.exports}();s.macro=function(){module={};module.exports=function(e,t){var n=_.clone(this.args),r=n.shift(),i="",s="";n.length&&(i=JSON.stringify(n).replace(/^\[|\'|\"|\]$/g,""));s+="_context."+r+" = function ("+i+") {\n";s+='  var _output = "";\n';s+=t.compile.apply(this,[e+"  "]);s+="  return _output;\n";s+="};\n";return s};module.exports.ends=!0;return module.exports}();s.parent=function(){module={};module.exports={};return module.exports}();s.raw=function(){module={};module.exports={ends:!0};return module.exports}();s.set=function(){module={};module.exports=function(e,t){var n=_.clone(this.args),i=r.escapeVarName(n.shift(),"_context"),s;if(n.shift()!=="=")throw new Error('Invalid token "'+n[1]+'" in {% set '+n[0]+' %}. Missing "=".');s=n[0];if(r.isLiteral(s)||/^\{|^\[/.test(s)||s==="true"||s==="false")return" "+i+" = "+s+";";s=t.parseVariable(s);return" "+i+" = "+"(function () {\n"+"  var _output;\n"+t.compile.apply({tokens:[s]},[e])+"\n"+"  return _output;\n"+"})();\n"};return module.exports}();return e}();var parseduration=helpers.parsetime;templates={buildElement:function(e){var t=e.template,n=e.parameters;callback=e.callback;if(savedtemplates[t]!=undefined){var r=templates.compileTemplate(savedtemplates[templates],t);templates.checkAndReturn({template:t,params:n,tmpl:r})}else{socket.emit("load-template",{name:t});socket.once("template",function(e){var r=templates.compileTemplate(e.template,t);templates.checkAndReturn({template:t,params:n,tmpl:r})})}},compileTemplate:function(e,t){savedtemplates[t]=swig.compile(e,{filename:t});return savedtemplates[t]},renderTemplate:function(e,t){var n=e(t);return n},dependencies:{album:["tracklist"]},dependenciesCheck:function(e){var t=e.cb,n=e.name,r=templates.dependencies[n],i=_.filter(r,function(e){return savedtemplates[e]==undefined});if(i.length!=0){function s(){var e=r[o];socket.emit("load-template",{name:e});socket.once("template",function(n){templates.compileTemplate(n.template,e);o++;o<u?s():t()})}var o=0,u=i.length;s()}else t()},checkAndReturn:function(e){var t=e.template,n=e.params,r=e.tmpl,i=templates.dependencies[t];templates.dependenciesCheck({cb:function(){i&&$.each(i,function(e,t){n[t]=savedtemplates[t]});n.parseduration=parseduration;n.parsetext=helpers.parsetext;n.parsehours=helpers.parsehours;var e=templates.renderTemplate(r,n);callback(e)},name:t})}};savedtemplates={};player={};player.playSong=function(e,t){var n=helpers.parseDOM(e);if($(e).hasClass("recognized")||n.ytid!=undefined){t?ytplayer.cueVideoById(n.ytid):ytplayer.loadVideoById(n.ytid);player.history.add(player.nowPlaying.get());player.nowPlaying.replace(n);$("title").text(n.name+" - "+n.artist);chinchilla.settings.favicon_album&&$("#favicon").attr("href",n.image)}else{console.log("Unrecognized song gets played");var r=e instanceof HTMLElement?$(e):$(".song[data-id="+e.id+"]")[0];$(r).addClass("wantstobeplayed");recognition.stop();recognition.queue.unshift(n);recognition.start()}};player.nowPlaying={replace:function(e){var e=helpers.parseDOM(e);localStorage.nowPlaying=JSON.stringify(e);$("#track-title a").text(e.name).attr("data-navigate","/song/"+e.id);$("#track-artist a").text(e.artist).attr("data-navigate","/artist/"+e.artistid);$("#track-album a").text(e.album).attr("data-navigate","/album/"+e.albumid);var t=$("#nowplaying-image"),n=$("#nowplaying-image2"),r=helpers.getHQAlbumImage(e,225);if(t.hasClass("np-placeholder-used")){t.removeClass("np-placeholder-used").attr("src","");n.attr("src",r).addClass("np-placeholder-used").one("load",function(){$(n).css({opacity:.7},400);$(t).css({opacity:0},400)})}else{n.removeClass("np-placeholder-used").attr("src","");t.attr("src",r).addClass("np-placeholder-used").one("load",function(){$(t).css({opacity:.7},400);$(n).css({opacity:0},400)})}$(".song").removeClass("now-playing");$(".song[data-id='"+e.id+"']").addClass("now-playing");var i=player.queue1.get(),s=player.queue2.get(),o=i.concat(s),u=o.shift(),a=player.history.get(),f=a.pop(),l=u!=undefined?"<strong>"+u.name+"</strong><br>"+u.artist:"There is no track in your queue!",c=f!=undefined?"<strong>"+f.name+"</strong><br>"+f.artist:"There is no track in your history!";$(".next-update").html(l);$(".prev-update").html(c);$("#skip").attr("data-tooltip","<div class='next-update'>"+l+"</div>");$("#rewind").attr("data-tooltip","<div class='prev-update'>"+c+"</div>")},get:function(e){helpers.localStorageSafety("nowPlaying");return localStorage["nowPlaying"]=="[]"?null:JSON.parse(localStorage.nowPlaying)}};var Queue=function(e){this.add=function(t,n){var t=helpers.parseDOM(t),r=e;helpers.localStorageSafety(r);helpers.addToLocalStorage(r,t,n);player.drawQueue();return helpers.getLocalStorage(r)};this.get=function(){return helpers.getLocalStorage(e)};this.clear=function(){return helpers.clearLocalStorage(e)};this.getAndRemoveFirst=function(){var t=helpers.getLocalStorage(e),n=t.splice(0,1);localStorage[e]=JSON.stringify(t);player.drawQueue();return n[0]};e=="history"&&(this.playLast=function(){var t=helpers.getLocalStorage(e);if(t.length!=0){player.queue1.add(player.nowPlaying.get(),!0);var n=t.pop();localStorage[e]=JSON.stringify(t);player.playSong(n);player.drawQueue()}})};player.queue1=new Queue("queue1");player.queue2=new Queue("queue2");player.history=new Queue("history");player.automaticseekblocked=!1;var stateChange=function(e){if(e==1){$("#play").hide();$("#pause").show()}else{e==0&&player.playNext();$("#pause").hide();$("#play").show()}},videoEnded=function(){player.playNext()};player.setUpEvents=function(){ytplayer.addEventListener("onStateChange","stateChange");ytplayer.addEventListener("onEnded","videoEnded");var e=function(){var t=ytplayer.getCurrentTime(),n=ytplayer.getDuration(),r=helpers.parsetime(t),i=helpers.parsetime(n);$("#time-right").text(i);$("#time-left").text(r);var s=t/n*100,o;if(!player.automaticseekblocked&&s)var o=s;if(s==NaN)var o=0;$("#seek-progress").css("width",o+"%");setTimeout(e,250)};e()};player.pause=function(){ytplayer.pauseVideo()};player.play=function(){ytplayer.playVideo()};player.seek=function(e){ytplayer.seekTo(e)};player.playNext=function(){var e=player.queue1.get().length==0?"queue2":"queue1",t=player[e].getAndRemoveFirst();player.playSong(t)};player.playLast=function(){player.history.playLast()};player.drawQueue=function(){var e=player.queue1.get(),t=player.queue2.get();queue=e.concat(t);queue=queue.slice(0,10);$("#queue").empty();$.each(queue,function(e,t){var n={"data-tooltip":"<strong>"+t.name+"</strong><br>"+t.artist,"class":"queue-song"};$.each(t,function(e,t){n["data-"+e]=t});var r=$("<div>",n),i=$("<img>",{src:t.image}).appendTo(r);r.appendTo("#queue")})};search={calls:[],autocomplete:function(e){search.calls=[];var t={artist:{iTunesName:"musicArtist",title:"artistName",sub:"primaryGenreName",element:$("#results-artists"),link:"/artist/$1",id:"artistId"},album:{iTunesName:"album",title:"collectionName",sub:"artistName",element:$("#results-albums"),link:"/album/$1",id:"collectionId"},track:{iTunesName:"song",title:"trackName",sub:"artistName",element:$("#results-tracks"),link:"/song/$1",id:"trackId"}};$.each(t,function(t,n){var r=$.ajax({url:"http://itunes.apple.com/search",data:{term:e,entity:n.iTunesName,limit:3},dataType:"jsonp",success:function(e){$(n.element).empty();$.each(e.results,function(e,t){var r=$("<div>",{"class":"search-result"});$("<div>",{"class":"search-result-title"}).text(t[n.title]).appendTo(r);$("<div>",{"class":"search-result-sub"}).text(t[n.sub]).appendTo(r);var i=$("<a>",{"data-navigate":n.link.replace("$1",t[n.id])}).html(r);i.appendTo(n.element)})}});search.calls.push(r)})}};var addToCollections,addToImportQueue,cancelEverything,determineProvider,determineTarget,droparea,fileDropped,importqueue,queuechanged,queuestarted,recognize,recognizeFile,recognizeSpotify,recognizeTracks,startQueue,stopQueue,textDropped,weirdThingDropped;droparea=$("#view");importqueue=[];queuestarted=!1;cancelEverything=function(e){e.stopPropagation();return e.preventDefault()};fileDropped=function(e){return _.each(e,function(e){var t;t={type:{provider:"file",id:e},target:determineTarget()};return addToImportQueue(t)})};textDropped=function(e){var t;t=e.split(/\n/);return _.each(t,function(e){var t;t={type:determineProvider(e),target:determineTarget()};if(t.type)return addToImportQueue(t)})};weirdThingDropped=function(){return console.log("something was dropped")};determineTarget=function(){return document.getElementById("view").dataset.route};determineProvider=function(e){return e.length===52&&e.substr(0,30)==="http://open.spotify.com/track/"?{provider:"spotify",id:e.substr(30)}:e.substr(0,28)==="http://www.youtube.com/watch"?{provider:"youtube",id:e.substr(31,11)}:!1};addToImportQueue=function(e){importqueue.push(e);return queuechanged()};queuechanged=function(){if(queuestarted){if(importqueue.length===0)return stopQueue()}else if(importqueue.length!==0)return startQueue()};startQueue=function(){queuestarted=!0;console.log("Queue started");return recognizeTracks()};stopQueue=function(){queuestarted=!1;return console.log("Queue ended")};recognizeTracks=function(){var e;e=importqueue.shift();return recognize(e,function(t){addToCollections(e,t);queuechanged();if(importqueue.length!==0)return recognizeTracks()})};recognize=function(e,t){if(e.type.provider==="spotify")return recognizeSpotify(e,function(e){return t(e)});if(e.type.provider==="file")return recognizeFile(e,function(e){return t(e)})};recognizeSpotify=function(e,t){return $.getJSON("http://ws.spotify.com/lookup/1/.json?uri=spotify:track:"+e.type.id,function(n){e={name:n.track.name,artist:n.track.artists[0].name};socket.emit("request-track-info",e);return socket.once("receive-track-info",function(e){var n;if(e.error)return t(null);n=e.song;return recognition.findVideo(n,function(e){n.ytid=helpers.parseYTId(e);socket.emit("new-track",n);return socket.once("track-uploaded",function(e){if(e===n.id)return t(n)})})})})};recognizeFile=function(e,t){var n;n=new FileReader;n.onload=function(n){var r;r=new jDataView(this.result);if(r.getString(3,r.byteLength-128)==="TAG"){e={name:r.getString(30,r.tell()),artist:r.getString(30,r.tell())};console.log(e);socket.emit("request-track-info",e);return socket.once("receive-track-info",function(e){var n;if(e.error){console.log("no track found");return t(null)}n=e.song;return recognition.findVideo(n,function(e){n.ytid=helpers.parseYTId(e);socket.emit("new-track",n);return socket.once("track-uploaded",function(e){if(e===n.id)return t(n)})})})}console.log("NO ID3");return t(null)};return n.readAsArrayBuffer(e.type.id)};addToCollections=function(e,t){var n;n=e.target;if(t)return _s.contains(n,"/u/")&&_s.contains(n,"/p/")?socket.emit("add-song-to-playlist",{token:chinchilla.token,songid:t.id,url:n}):socket.emit("add-track",{token:chinchilla.token,song:{id:t.id},destination:"library"})};$(document).ready(function(){document.addEventListener("dragenter",function(e){return cancelEverything(e)});document.getElementById("dropfiles").addEventListener("dragleave",function(){document.getElementById("dropfiles").className="";return document.getElementById("dropfilescontent").className=""});document.addEventListener("dragover",function(e){document.getElementById("dropfiles").className="drag-hover";document.getElementById("dropfilescontent").className="drag-hover";return cancelEverything(e)});return document.addEventListener("drop",function(e){var t,n;document.getElementById("dropfiles").className="";document.getElementById("dropfilescontent").className="";cancelEverything(e);t=e.dataTransfer.files;n=e.dataTransfer.getData("Text");return t.length!==0?fileDropped(t):n!==""?textDropped(n):weirdThingDropped()})});var select=function(e){if(e.shiftKey){shiftSelect(this);return}if(e.ctrlKey||e.metaKey){cmdSelect(this);return}if($(e.srcElement).hasClass("heart"))return;if($(this).hasClass("selected")&&e.button==0){var t=$(".song.selected").not(this),n=$(this);$(document).one("mouseup",function(){n.addClass("selected");$(t).removeClass("selected")});dragsongs(e);return}if(e.button==0){var t=$(".song.selected").not(this);$(this).addClass("selected");$(t).removeClass("selected");dragsongs(e)}},dragsongs=function(e){var t={x:e.clientX,y:e.clientY},n=_.map($(".selected"),function(e){return e.dataset}),r=$(".playlistmenuitem, .librarymenuitem");n.length==1?$("#draglabel").text(n[0].name+" - "+n[0].artist):$("#draglabel").text(n.length+" tracks");document.body.style.cursor="default";$(document).on("mousemove",function(e){var n=Math.sqrt(Math.pow(Math.abs(e.clientX-t.x),2)+Math.pow(Math.abs(e.clientY-t.y),2));n>20&&$("#draglabel").css({top:e.clientY-30,left:e.clientX}).show()});r.on("mouseenter",function(){$(this).addClass("droppableindicator")});r.on("mouseleave",function(){$(this).removeClass("droppableindicator")});r.one("mouseup",function(){$(this).removeClass("droppableindicator");var e=$(this).attr("data-navigate");_.each(n,function(t){e=="/library"?socket.emit("add-track",{token:chinchilla.token,song:{id:t.id},destination:"library"}):socket.emit("add-song-to-playlist",{token:chinchilla.token,songid:t.id,url:e})})});$(document).one("mouseup",function(e){$(document).off("mousemove");$("#draglabel").hide();r.off("mouseenter mouseup")})};window.playSong=function(e){if($(e.srcElement).hasClass("heart"))return;var t=$(this).nextAll(".song");player.queue1.clear();player.queue2.clear();$.each(t,function(e,t){player.queue2.add(t)});player.playSong(this)};var shiftSelect=function(e){var t=$(e),n=t.prevAll(".selected")[0],r=t.nextAll(".selected")[0];n!==undefined&&t.prevUntil(n,".song").andSelf().addClass("selected");r!==undefined&&t.nextUntil(r,".song").andSelf().addClass("selected")},cmdSelect=function(e){$(e).toggleClass("selected")},dragSeek=function(e){var t=224;player.automaticseekblocked=!0;var n=function(e){var n=e.pageX;$("#seek-progress").css("width",n/t*100+"%")};$(document).on("mousemove",n);$(document).one("mouseup",function(e){$(document).off("mousemove");var n=e.pageX;if(n>224)var n=224;player.seek(n/t*ytplayer.getDuration());player.automaticseekblocked=!1})},resume=function(e){player.play()},pause=function(e){player.pause()},skip=function(){player.playNext()},rewind=function(){player.playLast()},tooltip=function(e){var t=this,n=$("<div>",{"class":"tooltip"}).css({top:$(t).offset().top+$(t).height()+3,left:$(t).offset().left}).html($(t).attr("data-tooltip")).appendTo("body");$(t).mouseout(function(){$(n).remove()})},autocomplete=function(){var e=$("#search-field"),t=e.val(),n=$("#search-results"),r=$("#clear-input");if(!window.lastsearchtimestamp)window.lastsearchtimestamp=Date.now();else{var i=Date.now();window.lastsearchtimestamp=i;setTimeout(function(){i==window.lastsearchtimestamp&&search.autocomplete(t)},500)}if(t===""){n.hide();r.hide()}else{n.show();r.show()}},logout=function(){var e=document.cookie.split(";");for(var t=0;t<e.length;t++){var n=e[t],r=n.indexOf("="),i=r>-1?n.substr(0,r):n;document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}window.location.reload()},addtolib=function(){if(!$(this).hasClass("song")&&!$(this).hasClass("library-button"))var e=$(this).parents(".song")[0];else var e=this;var t=helpers.parseDOM(e);library.add(t)},remfromlib=function(){if(!$(this).hasClass("song")&&!$(this).hasClass("library-remove-button"))var e=$(this).parents(".song")[0];else var e=this;var t=helpers.parseDOM(e);library.remove(t)},clearinput=function(){$("#search-field").val("").keyup();window.lastsearchtimestamp=null},rightclick=function(e){e.preventDefault();var t={song:helpers.parseDOM(e.currentTarget),e:e,left:e.pageX};contextmenu(t)},playlistmenu=function(e){e.preventDefault();var t={e:e,left:e.pageX,playlist:e.currentTarget};contextmenu(t)},contextmenu=function(e){$(".contextmenu").remove();var t=e.song?"#view":"#sidebar",n=$(t)[0].scrollHeight,r={top:e.e.pageY,left:e.left,bottom:document.height-e.e.pageY},i=e.e.pageY<document.height/2?r.top:r.bottom,s=e.e.pageY<document.height/2?"top":"bottom",o=$("<div>",{"class":"contextmenu"}).css({left:r.left}).css(s,i).html('<div class="loading-indicator"><div class="spinner"></div></div>').appendTo(t);$(document).one("click",function(){o.remove()});if(e.song){$(document).one("click",".contextmenu-add-to-playlist",function(e){$(this).parents(".context-options").html(loader.spinner());e.stopPropagation();socket.emit("add-playlist-dialogue",{song:this.dataset.id,token:chinchilla.token});socket.once("add-playlist-dialog-response",function(e){$(".context-options").html(e.html)})});var u=e.song;socket.emit("get-contextmenu",{song:u,state:chinchilla});socket.once("contextmenu",function(e){o.html(e.html)})}else if(e.playlist){var a=e.playlist.dataset.navigate;socket.emit("get-playlist-contextmenu",{playlist:a,state:chinchilla});socket.once("playlist-contextmenu",function(e){o.html(e.html)})}},setchange=function(){var e=$(".settings .setting"),t=[];$.each(e,function(e,n){var n={key:n.dataset.setting,label:$(n).find("p").text(),value:$(n).find("input").is(":checked")};t.push(n);chinchilla.settings[n.key]=n.value});socket.emit("update-settings",{settings:t,token:chinchilla.token});socket.once("settings-saved",function(){console.log("Settings saved")})},ordersongs=function(){var e,t=$(this);if(t.hasClass("ascending")){t.addClass("descending");t.removeClass("ascending");e="desc"}else if(t.hasClass("descending")){t.removeClass("descending");e="default"}else{t.addClass("ascending");e="asc"}$(t).siblings("th").removeClass("ascending descending");var n=e=="default"?"index":t.attr("data-value"),r=t.parents("table").eq(0),i=$(r).find(".song"),s=_.sortBy(i,function(e){var t=e.dataset[n];return isNaN(t)?t:parseFloat(t)}),o=e=="desc"?s.reverse():s;html="";i.remove();$.each(s,function(e,t){r.append(t)})},playalbum=function(){var e=$(this).parents(".album"),t=e.find(".song.recognized"),n=t.splice(0,1)[0];player.queue2.clear();$.each(t,function(e,t){player.queue2.add(t)});player.playSong(n)},findandplay=function(){var e=$(this).attr("data-id"),t=$(".song[data-id="+e+"]").eq(0)[0];player.playSong(t)},addalbumtolib=function(){var e=$(this).parents(".album"),t=e.find(".song.recognized"),n=[];$.each(t,function(e,t){n.push(helpers.parseDOM(t))});library.batchAdd(n)},keys=function(e){var t=e.keyCode;if($(e.srcElement).is("input"))return;e.preventDefault();if(t==40||t==38){var n=$(".song.selected"),r=t==40?"next":"prev",i=n[r](".song").addClass("selected");!e.shiftKey&&i.length!=0&&n.removeClass("selected")}if(t==13){var s=$(".song.selected.recognized"),o=s[s.length-1],u=s.splice(0,1);player.playSong(u[0]);player.queue2.clear();player.queue1.clear();_.each(s,function(e){player.queue1.add(e)});var a=$(o).nextAll(".song.recognized");$.each(a,function(e,t){player.queue2.add(helpers.parseDOM(t))})}},hidenotification=function(){$(this).parents(".notification").remove()},warnexit=function(){if(chinchilla.loggedin&&chinchilla.settings.warn_before_leave)return"You are leaving the page but the music is still playing. Do you really want to leave? (You can turn this notification off in the settings)"},showalbum=function(){$(this).hide().next(".hidden-album-container").show()},newplaylist=function(){$(".new-playlist-input").show().find("input").val("").focus();$("html").one("click",function(){$(".new-playlist-input").hide().off();$(".new-playlist-input-field").off()});$(".new-playlist-input").on("click",function(e){e.stopPropagation()});$(".new-playlist-input-field").on("keypress",submitplaylist)},submitplaylist=function(e){if(e.keyCode==13){$(".new-playlist-input-field").off();socket.emit("add-playlist",{name:$(".new-playlist-input-field").val(),token:chinchilla.token})}},renameplaylist=function(){function i(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges();n.addRange(t)}var e=this.dataset.id,t=this.dataset.name,n=$('#sidebar [data-navigate="'+e+'"]'),r=n.find(".pl-label").attr("contenteditable",!0).focus();$(r).on("keypress",function(t){if(t.keyCode==13){$(r).off().removeAttr("contenteditable");$("body").off();socket.emit("rename-playlist",{oldname:e,newname:$(r).text(),token:chinchilla.token});$(n).hide()}});i($(r)[0]);$("body").one("click",function(){$(r).off().removeAttr("contenteditable");$(r).text(t)});$(r).on("click",function(e){e.stopPropagation()})},deleteplaylist=function(){var e=this.dataset.id,t=$('#sidebar [data-navigate="'+e+'"]');socket.emit("delete-playlist",{url:e,token:chinchilla.token})},suppressrenaming=function(e){e.stopPropagation()},addsongtopl=function(){var e=this.dataset;e.token=chinchilla.token;socket.emit("add-song-to-playlist",e)},remsongfrompl=function(){var e=this.dataset;e.token=chinchilla.token;socket.emit("remove-song-from-playlist",e)},pldropdown=function(){$(".playlist-options-dropdown").toggle();if($(".playlist-options-dropdown").is(":visible")){$("body").one("click contextmenu",function(){$(".playlist-options-dropdown").hide()});$(".playlist-options-dropdown").html(loader.spinner());socket.emit("get-playlist-options",{playlist:$("#view").attr("data-route"),token:chinchilla.token});socket.once("playlist-options",function(e){$(".playlist-options-dropdown").html(e.html)})}},mkplpublic=function(){var e=$("#view").attr("data-route"),t=$(".playlist-privacy");t.find("span").text("Public");t.find("img").attr("src","/api/svg/public");socket.emit("change-playlist-privacy",{playlist:e,token:chinchilla.token,"public":!0})},mkplprivate=function(){var e=$("#view").attr("data-route"),t=$(".playlist-privacy");t.find("span").text("Private");t.find("img").attr("src","/api/svg/lock");socket.emit("change-playlist-privacy",{playlist:e,token:chinchilla.token,"public":!1})},mkplnwattop=function(){var e=$("#view").attr("data-route"),t=$(".playlist-privacy");socket.emit("change-playlist-order",{playlist:e,token:chinchilla.token,newestattop:!0})},mkplnwatbottom=function(){var e=$("#view").attr("data-route"),t=$(".playlist-privacy");socket.emit("change-playlist-order",{playlist:e,token:chinchilla.token,newestattop:!1})};$(document).on("mousedown","tr.song",select).on("keyup","body",keys).on("dblclick",".song",playSong).on("mousedown","#seek-bar",dragSeek).on("click","#play",resume).on("click","#pause",pause).on("click","#skip",skip).on("click","#rewind",rewind).on("mouseover","[data-tooltip]",tooltip).on("keyup","#search-field",autocomplete).on("click","#clear-input",clearinput).on("click",".play-button",playSong).on("click",".library-button",addtolib).on("click",".library-remove-button",remfromlib).on("click",".not-in-library .heart",addtolib).on("click",".in-library .heart",remfromlib).on("click","#logout",logout).on("contextmenu",".song.recognized, .queue-song",rightclick).on("contextmenu",".playlistmenuitem",playlistmenu).on("change",".settings input",setchange).on("click","[data-order]",ordersongs).on("click",".play-all-album",playalbum).on("click",".add-all-album",addalbumtolib).on("click",".findandplay",findandplay).on("click",".notification .actions span",hidenotification).on("click",".albumhidden-message",showalbum).on("click",".add-new-playlist",newplaylist).on("click",".rename-playlist-button",renameplaylist).on("click",".pl-label[contenteditable]",suppressrenaming).on("click",".delete-playlist-button",deleteplaylist).on("click",".add-song-to-playlist-button",addsongtopl).on("click",".remove-song-from-playlist-button",remsongfrompl).on("click",".playlist-privacy",pldropdown).on("click",".make-playlist-public",mkplpublic).on("click",".make-playlist-private",mkplprivate).on("click",".make-playlist-newest-at-top",mkplnwattop).on("click",".make-playlist-newest-at-bottom",mkplnwatbottom);$(window).on("beforeunload",warnexit);$(document).ready(function(){$.subscribe("new-tracks-entered-dom",function(){var e=$(".not-recognized");recognition.queue.clear();_.each(e,function(e){recognition.queue.push(e)});$('.song[data-id="'+player.nowPlaying.get().id+'"]').addClass("now-playing")})});errors={draw:function(e){$("#view").load("/api/error/"+e)}};var recognitionAdditionHandler=function(){recognition.started==0&&recognition.start()};recognition={recognizeAlbum:function(e){var t=$(e).find(".album-tracks table tbody tr.song.not-recognized");$.each(t,function(e,t){recognition.queue.push(t)})},recognizeTrackList:function(e){var t=$(e).find("tr.song.not-recognized");$.each(t,function(e,t){recognition.queue.push(t)})},queue:new EventedArray(recognitionAdditionHandler),recognizeTrack:function(e){var t=e.track,n=e.cb,r=helpers.parseDOM(t),i=t.length!=undefined&&t.length!=0?t[0]:t,s=i instanceof HTMLElement?$(i):$(".song[data-id="+i.id+"]")[0];if($(s).hasClass("recognized")){n();return}recognition.findVideo(r,function(e){if(e){var i=$('.song[data-id="'+r.id+'"]').attr("data-ytid",e.id.$t.substr(-11));i.addClass("recognized").removeClass("not-recognized pending");recognition.uploadTrack(r,e);if($(i).hasClass("wantstobeplayed")){$(i).removeClass("wantstobeplayed");player.playSong($(i)[0])}var o=$(t).parents(".album");if(o.length!=0){var u=$(t).parents(".album").find(".recognized").length+1,a=o.data("tracks");u==a&&recognition.uploadAlbum(o[0])}}else $(s).addClass("no-video-found");n()})},started:!1,start:function(){recognition.started=!0;var e=function(){recognition.recognizeTrack({track:recognition.queue.getArray()[0],cb:function(){if(recognition.started){recognition.queue.shift();recognition.queue.getArray().length==0?recognition.stop():e()}}})};e()},stop:function(){recognition.started=!1},findVideo:function(e,t,n,r,i){n!=undefined&&($=n);r!=undefined&&(_=r);i!=undefined&&(_s=i);e.name=e.title==undefined?e.name:e.title;$.ajax({url:"http://gdata.youtube.com/feeds/api/videos",data:{alt:"json","max-results":15,q:e.artist+" - "+e.name},success:function(n){recognition.findBestVideo(n,e,function(e){t(e)},_,_s)}})},findBestVideo:function(e,t,n,r,i){var s=e.feed.entry,o=r.max(s,function(e){var t=e.yt$statistics!=undefined?parseFloat(e.yt$statistics.viewCount):0;return t});mostviews=o.yt$statistics?o.yt$statistics.viewCount:0;r.map(s,function(e){e.points=0;var n=i.slugify(e.title.$t),s=i.slugify(t.artist+" - "+t.name),o=i.slugify(t.name+" - "+t.artist),u=i.levenshtein(n,s),a=i.levenshtein(n,o),f=u<a?u:a,l=300-f*5,l=l<0?0:l;e.points+=l;var c=e.media$group.yt$duration.seconds,h=t.duration/1e3,p=Math.abs(c-h);tolerance=1,minuspoints=p===0?0:(p-1)*5;durpoints=150-minuspoints;durpoints=durpoints<0?0:durpoints;e.points+=durpoints;var d=e.yt$statistics?parseFloat(e.yt$statistics.viewCount):0,v=d/mostviews;viepoints=Math.ceil(v*50);e.points+=viepoints;var m=e.gd$rating?e.gd$rating.average*20:0;ratpoints=Math.ceil(m*1.5);e.points+=ratpoints;e.points+=200;var g=["cover","parod","chipmunk","snippet","preview","live","review","vocaloid","dance"];r.each(g,function(t){i.include(n.toLowerCase(),t)&&!i.include(s,t)&&(e.points-=75)});e.points+=50;if(i.include(n.toLowerCase()),t.album&&(i.include(s,"skit")||i.include(s,"intro")||i.include(s,"outro")))e.points-=50});var u=r.first(r.sortBy(s,function(e){return e.points}).reverse());u&&console.log("The best video has ",u.points," points!",t.name);n(u)},uploadTrack:function(e,t){var n=t.id.$t.substr(-11),r=e;r.ytid=n;r.id=parseFloat(r.id);socket.emit("new-ytid",r)},uploadAlbum:function(e){var t=$(e).data(),n=$(e).find(".song"),r=[];$.each(n,function(e,t){r.push($(t).data("id"))});t.tracklist=r;socket.emit("new-album",t)}};this.recognition=recognition;var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName
("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n();t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");if(t){t=t.split(" ")[1].split(",");T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}else if(o<10){o++;setTimeout(arguments.callee,10);return}n.removeChild(r);s=null;M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312)){V(r,!0);if(i){s.success=!0;s.ref=_(r);i(s)}}else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall;u.width=o.getAttribute("width")||"0";u.height=o.getAttribute("height")||"0";o.getAttribute("class")&&(u.styleclass=o.getAttribute("class"));o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else{H(o);i&&i(s)}}else{V(r,!0);if(i){var p=_(r);if(p&&typeof p.SetVariable!=e){s.success=!0;s.ref=p}i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0;g=i||null;y={success:!1,id:r};var o=R(r);if(o){if(o.nodeName=="OBJECT"){v=B(o);m=null}else{v=o;m=r}t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?"ActiveX":"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew";c.setAttribute("id",r);o.parentNode.insertBefore(c,o);o.style.display="none";(function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)})()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(B(e),t);e.style.display="none";(function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)})()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>";p[p.length]=n.id;o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u);o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t);r.setAttribute("value",n);e.appendChild(r)}function I(e){var t=R(e);if(t&&t.nodeName=="OBJECT")if(T.ie&&T.win){t.style.display="none";(function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)})()}else t.parentNode.removeChild(t)}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n);d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");n[0]=parseInt(n[0],10);n[1]=parseInt(n[1],10)||0;n[2]=parseInt(n[2],10)||0;return t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";if(s){E=null;S=null}if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css");f.setAttribute("media",u);E=o.appendChild(f);T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]);S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t){g=f.plugins[n].description;if(g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)){l=!0;v=!1;g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1");m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10);m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10);m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof u.ActiveXObject!=e)try{var y=new ActiveXObject(r);if(y){g=y.GetVariable("$version");if(g){v=!0;g=g.split(" ")[1].split(",");m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}}}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C();if(!b){typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1);if(T.ie&&T.win){a.attachEvent(o,function(){if(a.readyState=="complete"){a.detachEvent(o,arguments.callee);C()}});u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()}T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}();L(C)}}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e;i.swfVersion=t;i.expressInstall=n;i.callbackFn=r;h[h.length]=i;V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};if(T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o){V(r,!1);k(function(){i+="";s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n;p.width=i;p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0);h.success=!0;h.ref=y}else{if(u&&D()){p.data=u;P(p,v,r,c);return}V(r,!0)}c&&c(h)})}else c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);if(e&&v){e.parentNode.replaceChild(v,e);if(m){V(m,!0);T.ie&&T.win&&(v.style.display="block")}g&&g(y)}w=!1}}}}();library={add:function(e){socket.emit("add-track",{destination:"library",song:e,token:chinchilla.token});markAsInLibrary(e.id);$(".library-button").text("Remove from library").removeClass("library-button").addClass("library-remove-button")},batchAdd:function(e){socket.emit("add-tracks",{destination:"library",songs:e,token:chinchilla.token});_.each(e,function(e){markAsInLibrary(e.id)})},remove:function(e){socket.emit("remove-track",{destination:"library",song:e,token:chinchilla.token});markAsNotInLibrary(e.id);$(".library-remove-button").text("Add to library").removeClass("library-remove-button").addClass("library-button");var t=$('#view[data-route="/library"] .song[data-id="'+e.id+'"]').remove()}};var markAsInLibrary=function(e){var t=$(".song[data-id="+e+"]");t.removeClass("not-in-library").addClass("in-library")},markAsNotInLibrary=function(e){$(".song[data-id="+e+"]").addClass("not-in-library").removeClass("in-library")}(function(e){var t=e({});e.subscribe=function(){t.on.apply(t,arguments)};e.unsubscribe=function(){t.off.apply(t,arguments)};e.publish=function(){t.trigger.apply(t,arguments)}}(jQuery));