{"ts":1359986152564,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var mongo      = require(\"mongoskin\"),\n\tauth \t   = require(\"../auth/auth\"),\n\tconnection = mongo.db(auth.auth, {safe: true}),\n\toptions\t   = {save: true, upsert: true};\n/*\n\tGet matching artists.\n\tExample structure of an artist:\n\t{\n\t\t\"name\": \"Favorite\", --> name of the artist\n    \t\"id\": 5078430       --> iTunes ID of the artist.\n    }\n*/\nthis.getArtist = function(artistid, callback) {\n\tconnection.collection(\"artists\").find({\"id\": parseFloat(artistid)}).toArray(function(err, items) {\n\t\tcallback(items)\n\t})\n}\n/*\n\tGet matching albums from an artist.\n\tExample structure of an album:\n\t{\n\t\t\"artist\": \"Casper, Favorite, Kollegah & Shiml\",   \t--> Name of the artists. Maybe need to splice them?    \n   \t\t\"released\": 2009,\t\t\t\t\t\t\t\t\t--> Release year\n   \t\t\"tracks\": 18,\t\t\t\t\t\t\t\t\t\t--> number of tracks\n   \t\t\"image\": \"http://a1964.......\",\t\t\t\t\t\t--> cover image. 100x100 format\n   \t\t\"artistid\": 62791592,\t\t\t\t\t\t\t\t--> iTunes ID of artist\n   \t\t\"id\": 311797472,\t\t\t\t\t\t\t\t\t--> iTunes ID of album\n   \t\t\"explicit\": true,\t\t\t\t\t\t\t\t\t--> does it include fuck? (true | false)\n   \t\t\"name\": \"Chronik II\",\t\t\t\t\t\t\t\t--> album name\n   \t\t\"tracklist\": [\t\t\t\t\t\t\t\t\t\t--> ID's of track names\n   \t\t    311797587,\n   \t\t    311797659,\n   \t\t    311797668\n   \t\t]\n    }\n*/\nthis.getAlbums = function(artistid, callback) {\n\tconnection.collection(\"albums\").find({\"artistid\": parseFloat(artistid)}, {sort:[['release', -1]]}).toArray(function(err, items) {\n\t\tcallback(items);\n\t})\n}\n/*\n\tGet track by a artist. Track structure:\n\t{\n\t\t\"artistid\": 5078430,\n\t\t\"albumid\": 433611130,\n\t\t\"id\": 433611169,\n\t\t\"artist\": \"Favorite\",\n\t\t\"album\": \"Christoph Alex\",\n\t\t\"name\": \"F.A.V. 2011\",\n\t\t\"preview\": \"http://a1916.phobos.apple.com/us/r1000/064/Music/1d/d8/87/mzi.hriidmxd.aac.p.m4a\",\n\t\t\"image\": \"http://a608.phobos.apple.com/us/r1000/069/Music/22/4f/6a/mzi.dnbcjybx.100x100-75.jpg\",\n\t\t\"release\": \"2011-05-06T07:00:00Z\",\n\t\t\"explicit\": true,\n\t\t\"cdcount\": 2,\n\t\t\"cdinalbum\": 1,\n\t\t\"tracks\": 16,\n\t\t\"numberinalbum\": 2,\n\t\t\"duration\": 197920,\n\t\t\"genre\": \"Hip Hop/Rap\",\n\t\t\"listens\": 0,\n\t\t\"ytid\": \"fsdfs-fssSfs\" //Optional!\n}\n*/\nthis.getTracks      = function(artist, callback) {\n\tconnection.collection(\"tracks\").find({\"artist\": artist}).toArray(function(err, items) {\n\t\tcallback(items)\n\t})\n}\nthis.getSingleAlbum = function(albumid, callback) {\n\t/*\n\t\tConvert albumid from a number into a string\n\t*/\n\tvar albumnumber = parseFloat(albumid);\n\tconnection.collection(\"albums\").find({id: albumnumber}).toArray(function(err, items) {\n\t\tcallback(items);\n\t})\n}\nthis.getTracksFromAlbum = function(albumid, callback) {\n\t/*\n\t\tConvert albumid from anumber into a string\n\t*/\n\tvar albumnumber = parseFloat(albumid);\n\tconnection.collection(\"tracks\").find({\"albumid\": albumnumber}).toArray(function(err, items) {\n\t\tcallback(items);\n\t})\n}\nthis.addTrack\t\t= function(track, callback) {\n\t//TODO: This could overwrite previous listens.\n\ttrack.listens = 0;\n\tconnection.collection(\"tracks\").update({id: track.id}, track, options, function(err) {\n\t\tif (err) {\n\t\t\tconsole.log(err);\n\t\t}\n\t\telse {\n\t\t\tcallback()\n\t\t}\n\t})\n}\nthis.addAlbum\t\t= function(album, callback) {\n\tconnection.collection(\"albums\").update({id: album.id}, album, options, function(err) {\n\t\tif (err) {\n\t\t\tconsole.log(err)\n\t\t}\n\t\telse {\n\t\t\tcallback()\n\t\t}\n\t})\n}\nthis.addArtist\t\t= function(artist, callback) {\n\tconnection.collection(\"artists\").update({id: artist.id}, artist, options, function(err) {\n\t\tif (!err) {\n\t\t\tcallback()\n\t\t}\n\t})\n}\nthis.getSongsByIds \t = function(ids, callback) {\n\t//This seems to fail on a few tracks! Alternative: getSongsByNames\n\tconnection.collection(\"tracks\").find({$or: ids}).toArray(function(err, items) {\n\t\tif (!err) {\n\t\t\tcallback(items)\n\t\t}\n\t})\n}\nthis.updateArtist    = function(info, callback) {\n\tconnection.collection(\"artists\").update({id: info.id}, info, options, function(err) {\n\t})\n}"]],"start1":0,"start2":0,"length1":0,"length2":3776}]],"length":3776}
{"contributors":[],"silentsave":false,"ts":1359986282201,"patch":[[{"diffs":[[0,"n(err, items) {\n"],[-1,"\t\t"],[1,"        if (!err) {\n            "],[0,"callback(items);"]],"start1":2701,"start2":2701,"length1":34,"length2":64},{"diffs":[[0,"ack(items);\n"],[1,"        }\n"],[0,"\t})"],[1,";"],[0,"\n}"],[1,";"],[0,"\nthis.addTra"]],"start1":2754,"start2":2754,"length1":29,"length2":41},{"diffs":[[0,"\t\tcallback()"],[1,";"],[0,"\n\t\t}\n\t})"],[1,";"],[0,"\n}"],[1,";"],[0,"\nthis.addAlb"]],"start1":3033,"start2":3033,"length1":34,"length2":37}]],"length":3821,"saved":false}
{"ts":1359986353136,"patch":[[{"diffs":[[0,"ist\n    "],[-1,"\t"],[1,"    "],[0,"\"id\": 50"]],"start1":270,"start2":270,"length1":17,"length2":20},{"diffs":[[0,"n(err, items) {\n"],[-1,"\t\t"],[1,"        if (!err) {\n            "],[0,"callback(items);"]],"start1":1390,"start2":1390,"length1":34,"length2":64},{"diffs":[[0,"items);\n"],[1,"        }\n"],[0,"\t})"],[1,";"],[0,"\n}"],[1,";"],[0,"\n/*\n\tGet"]],"start1":1447,"start2":1447,"length1":21,"length2":33},{"diffs":[[0,"n(err, items) {\n"],[-1,"\t\t"],[1,"        if (!err) {\n            "],[0,"callback(items)\n"]],"start1":2219,"start2":2219,"length1":34,"length2":64},{"diffs":[[0,"k(items)"],[1,";\n        }"],[0,"\n\t})"],[1,";"],[0,"\n}"],[1,";"],[0,"\nthis.ge"]],"start1":2274,"start2":2274,"length1":22,"length2":35},{"diffs":[[0,"n(err, items) {\n"],[-1,"\t\t"],[1,"        if (!err) {\n           "],[0,"callback(items);"]],"start1":2520,"start2":2520,"length1":34,"length2":63},{"diffs":[[0,"(items);"],[1," \n        }"],[0,"\n\t})"],[1,";"],[0,"\n}"],[1,";"],[0,"\nthis.ge"]],"start1":2575,"start2":2575,"length1":22,"length2":35}]],"length":3951,"saved":false}
{"ts":1359986362673,"patch":[[{"diffs":[[0,"nection "],[1," "],[0,"= mongo."]],"start1":80,"start2":80,"length1":16,"length2":17},{"diffs":[[0,"}),\n"],[-1,"\t"],[1,"    "],[0,"options"],[-1,"\t"],[1,"  "],[0,"   ="]],"start1":122,"start2":122,"length1":17,"length2":21}]],"length":3956,"saved":false}
{"ts":1359986367535,"patch":[[{"diffs":[[0,",\n\tauth "],[-1,"\t"],[1,"    "],[0,"   = req"]],"start1":37,"start2":37,"length1":17,"length2":20}]],"length":3959,"saved":false}
{"ts":1359986371594,"patch":[[{"diffs":[[0," mongo      "],[1," "],[0,"= require(\"m"]],"start1":3,"start2":3,"length1":24,"length2":25}]],"length":3960,"saved":false}
{"ts":1359986391884,"patch":[[{"diffs":[[0,"tems) {\n"],[-1,"\t\t"],[1,"        if (!err) {\n            "],[0,"callback"]],"start1":489,"start2":489,"length1":18,"length2":48},{"diffs":[[0,"k(items)"],[1,";\n        }"],[0,"\n\t})"],[1,";"],[0,"\n}"],[1,";"],[0,"\n/*\n\tGet"]],"start1":536,"start2":536,"length1":22,"length2":35}]],"length":4003,"saved":false}
{"ts":1359986505633,"patch":[[{"diffs":[[0,"iml\",   "],[-1,"\t"],[1,"  "],[0,"--> Name"]],"start1":683,"start2":683,"length1":17,"length2":18},{"diffs":[[0,"    \n   "],[-1,"\t\t"],[1,"     "],[0,"\"release"]],"start1":744,"start2":744,"length1":18,"length2":21},{"diffs":[[0,"\": 2009,"],[-1,"\t\t\t\t\t\t\t\t\t"],[1,"                                   "],[0,"--> Rele"]],"start1":766,"start2":766,"length1":25,"length2":51},{"diffs":[[0,"ase year\n   "],[-1,"\t\t"],[1,"     "],[0,"\"tracks\": 18"]],"start1":817,"start2":817,"length1":26,"length2":29},{"diffs":[[0,"ks\": 18,"],[-1,"\t\t\t\t\t\t\t\t\t\t"],[1,"                                       "],[0,"--> numb"]],"start1":839,"start2":839,"length1":26,"length2":55},{"diffs":[[0,"acks\n   "],[-1,"\t\t"],[1,"     "],[0,"\"image\":"]],"start1":902,"start2":902,"length1":18,"length2":21},{"diffs":[[0,"......\","],[-1,"\t\t\t\t\t\t"],[1,"                     "],[0,"--> cove"]],"start1":938,"start2":938,"length1":22,"length2":37},{"diffs":[[0,"rmat\n   "],[-1,"\t\t"],[1,"     "],[0,"\"artisti"]],"start1":994,"start2":994,"length1":18,"length2":21},{"diffs":[[0,"2791592,"],[-1,"\t\t\t\t\t\t\t\t"],[1,"                               "],[0,"--> iTun"]],"start1":1020,"start2":1020,"length1":24,"length2":47},{"diffs":[[0,"tist\n   "],[-1,"\t\t"],[1,"     "],[0,"\"id\": 31"]],"start1":1078,"start2":1078,"length1":18,"length2":21},{"diffs":[[0,"1797472,"],[-1,"\t\t\t\t\t\t\t\t\t"],[1,"                                    "],[0,"--> iTun"]],"start1":1099,"start2":1099,"length1":25,"length2":52},{"diffs":[[0,"lbum\n   "],[1," "],[-1,"\t\t"],[1,"    "],[0,"\"explici"]],"start1":1161,"start2":1161,"length1":18,"length2":21},{"diffs":[[0,"\": true,"],[-1,"\t\t\t\t\t\t\t\t\t"],[1,"                                   "],[0,"--> does"]],"start1":1183,"start2":1183,"length1":25,"length2":51},{"diffs":[[0,"include "],[1,"the word "],[0,"fuck? (t"]],"start1":1238,"start2":1238,"length1":16,"length2":25},{"diffs":[[0,"lse)\n   "],[-1,"\t\t"],[1,"     "],[0,"\"name\": "]],"start1":1271,"start2":1271,"length1":18,"length2":21},{"diffs":[[0,"nik II\","],[-1,"\t\t\t\t\t\t\t\t"],[1,"                               "],[0,"--> albu"]],"start1":1297,"start2":1297,"length1":24,"length2":47},{"diffs":[[0,"name\n   "],[1,"  "],[-1,"\t\t"],[1,"   "],[0,"\"trackli"]],"start1":1346,"start2":1346,"length1":18,"length2":21},{"diffs":[[0,"\": ["],[-1,"\t\t\t\t\t\t\t\t\t\t"],[1,"                                      "],[0,"--> "]],"start1":1369,"start2":1369,"length1":18,"length2":46},{"diffs":[[0,"ck names\n   "],[-1,"\t\t"],[1,"     "],[0,"    31179758"]],"start1":1426,"start2":1426,"length1":26,"length2":29},{"diffs":[[0,"1797587,\n   "],[-1,"\t\t"],[1,"     "],[0,"    31179765"]],"start1":1449,"start2":1449,"length1":26,"length2":29},{"diffs":[[0,"659,\n   "],[-1,"\t\t"],[1,"     "],[0,"    3117"]],"start1":1476,"start2":1476,"length1":18,"length2":21},{"diffs":[[0,"7668"],[1,","],[0,"\n   "],[-1,"\t\t"],[1,"            .......\n        "],[0,"]\n  "]],"start1":1498,"start2":1498,"length1":14,"length2":41}]],"length":4270,"saved":false}
{"ts":1359986510579,"patch":[[{"diffs":[[0,"log(err)"],[1,";"],[0,"\n\t\t}\n\t\te"]],"start1":3665,"start2":3665,"length1":16,"length2":17}]],"length":4271,"saved":false}
{"ts":1359986512281,"patch":[[{"diffs":[[0," {\n\t\t\tcallback()"],[1,";"],[0,"\n\t\t}\n\t})\n}\nthis."]],"start1":3685,"start2":3685,"length1":32,"length2":33}]],"length":4272,"saved":false}
{"ts":1359986514212,"patch":[[{"diffs":[[0,"lback();\n\t\t}\n\t})"],[1,";"],[0,"\n}\nthis.addArtis"]],"start1":3694,"start2":3694,"length1":32,"length2":33}]],"length":4273,"saved":false}
{"ts":1359986520942,"patch":[[{"diffs":[[0,"}\n\t});\n}"],[1,";"],[0,"\nthis.ad"]],"start1":3705,"start2":3705,"length1":16,"length2":17},{"diffs":[[0,"llback()"],[1,";"],[0,"\n\t\t}\n\t})"],[1,";"],[0,"\n}"],[1,";"],[0,"\nthis.ge"]],"start1":3872,"start2":3872,"length1":26,"length2":29}]],"length":4277,"saved":false}
{"ts":1359986527549,"patch":[[{"diffs":[[0,"gsByIds "],[-1,"\t"],[0," = funct"]],"start1":3905,"start2":3905,"length1":17,"length2":16}]],"length":4276,"saved":false}
{"ts":1359986566642,"patch":[[{"diffs":[[0,"{\n\t\tif (!err) {\n"],[-1,"\t\t\t"],[1,"            "],[0,"callback(items)\n"]],"start1":4089,"start2":4089,"length1":35,"length2":44},{"diffs":[[0,"ems)"],[1,";"],[0,"\n\t\t}\n\t})"],[1,";"],[0,"\n}"],[1,";"],[0,"\nthi"]],"start1":4128,"start2":4128,"length1":18,"length2":21},{"diffs":[[0,"ion(info"],[-1,", callback"],[0,") {\n\tcon"]],"start1":4174,"start2":4174,"length1":26,"length2":16},{"diffs":[[0,"ions"],[-1,", function(err) {\n\t})\n}"],[1,");\n};"]],"start1":4251,"start2":4251,"length1":27,"length2":9}]],"length":4260,"saved":false}
{"ts":1359987668490,"patch":[[{"diffs":[[0,"      }\n\t});\n};\n"],[1,"this.getSingleTrack = function (id, callback) {\n    connection.collection(\"tracks\").find({\"id\": id}).toArray(function(err, item) {\n        if (!err) {\n            callback(item);\n        }\n    });\n};\n"],[0,"this.getSingleAl"]],"start1":2605,"start2":2605,"length1":32,"length2":232}]],"length":4460,"saved":false}
